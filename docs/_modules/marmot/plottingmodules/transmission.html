
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>marmot.plottingmodules.transmission &#8212; Marmot 0.11.0 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">Marmot 0.11.0 documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../get-started/index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../how-to/index.html">
  How-to Guides
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../plot-gallery/index.html">
  Plotting Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../references/input-files/files.html">
  Input File Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../references/code/modules.html">
  Code Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/NREL/Marmot" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <h1>Source code for marmot.plottingmodules.transmission</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;System transmission plots.</span>

<span class="sd">This code creates transmission line and interface plots.</span>

<span class="sd">@author: Daniel Levie, Marty Schwarz</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">marmot.utils.mconfig</span> <span class="k">as</span> <span class="nn">mconfig</span>
<span class="kn">from</span> <span class="nn">marmot.metamanagers.read_metadata</span> <span class="kn">import</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.plot_data_helper</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GenCategories</span><span class="p">,</span>
    <span class="n">PlotDataStoreAndProcessor</span><span class="p">,</span>
    <span class="n">set_facet_col_row_dimensions</span><span class="p">,</span>
    <span class="n">set_x_y_dimension</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.plot_exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DataSavedInModule</span><span class="p">,</span>
    <span class="n">InputSheetError</span><span class="p">,</span>
    <span class="n">MissingInputData</span><span class="p">,</span>
    <span class="n">MissingMetaData</span><span class="p">,</span>
    <span class="n">MissingZoneData</span><span class="p">,</span>
    <span class="n">UnderDevelopment</span><span class="p">,</span>
    <span class="n">UnsupportedAggregation</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.plot_library</span> <span class="kn">import</span> <span class="n">PlotLibrary</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.styles</span> <span class="kn">import</span> <span class="n">ColorList</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.timeseries_modifiers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">adjust_for_leapday</span><span class="p">,</span>
    <span class="n">set_timestamp_date_range</span><span class="p">,</span>
    <span class="n">sort_duration</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;plotter.&quot;</span> <span class="o">+</span> <span class="vm">__name__</span><span class="p">)</span>
<span class="n">plot_data_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_data&quot;</span><span class="p">)</span>
<span class="n">shift_leapday</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;shift_leapday&quot;</span><span class="p">)</span>
<span class="n">xdimension</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;figure_size&quot;</span><span class="p">,</span> <span class="s2">&quot;xdimension&quot;</span><span class="p">)</span>
<span class="n">ydimension</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;figure_size&quot;</span><span class="p">,</span> <span class="s2">&quot;ydimension&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Transmission"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission">[docs]</a><span class="k">class</span> <span class="nc">Transmission</span><span class="p">(</span><span class="n">PlotDataStoreAndProcessor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;System transmission plots.</span>

<span class="sd">    The transmission.py module contains methods that are</span>
<span class="sd">    related to the transmission network.</span>

<span class="sd">    Transmission inherits from the PlotDataStoreAndProcessor class to assist</span>
<span class="sd">    in creating figures.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">Zones</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">Scenarios</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">AGG_BY</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ordered_gen</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">marmot_solutions_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">gen_categories</span><span class="p">:</span> <span class="n">GenCategories</span> <span class="o">=</span> <span class="n">GenCategories</span><span class="p">(),</span>
        <span class="n">scenario_diff</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">xlabels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_xticklabels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">color_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">ColorList</span><span class="p">()</span><span class="o">.</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">region_mapping</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            Zones (List[str]): List of regions/zones to plot.</span>
<span class="sd">            Scenarios (List[str]): List of scenarios to plot.</span>
<span class="sd">            AGG_BY (str): Informs region type to aggregate by when creating plots.</span>
<span class="sd">            ordered_gen (List[str]): Ordered list of generator technologies to plot,</span>
<span class="sd">                order defines the generator technology position in stacked bar and area plots.</span>
<span class="sd">            marmot_solutions_folder (Path): Directory containing Marmot solution outputs.</span>
<span class="sd">            gen_categories (GenCategories): Instance of GenCategories class, groups generator technologies</span>
<span class="sd">                into defined categories.</span>
<span class="sd">                Deafults to GenCategories.</span>
<span class="sd">            scenario_diff (List[str], optional): 2 value list, used to compare 2</span>
<span class="sd">                scenarios.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            ylabels (List[str], optional): y-axis labels for facet plots.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            xlabels (List[str], optional): x-axis labels for facet plots.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            custom_xticklabels (List[str], optional): List of custom x labels to</span>
<span class="sd">                apply to barplots. Values will overwite existing ones.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            color_list (list, optional): List of colors to apply to non-gen plots.</span>
<span class="sd">                Defaults to ColorList().colors.</span>
<span class="sd">            region_mapping (pd.DataFrame, optional): Mapping file to map</span>
<span class="sd">                custom regions/zones to create custom aggregations.</span>
<span class="sd">                Aggregations are created by grouping PLEXOS regions.</span>
<span class="sd">                Defaults to pd.DataFrame().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Instantiation of PlotDataStoreAndProcessor</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="n">ordered_gen</span><span class="p">,</span> <span class="n">marmot_solutions_folder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span> <span class="o">=</span> <span class="n">Zones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span> <span class="o">=</span> <span class="n">Scenarios</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_categories</span> <span class="o">=</span> <span class="n">gen_categories</span>
        <span class="k">if</span> <span class="n">scenario_diff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_diff</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_diff</span> <span class="o">=</span> <span class="n">scenario_diff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span> <span class="o">=</span> <span class="n">ylabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span> <span class="o">=</span> <span class="n">xlabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_xticklabels</span> <span class="o">=</span> <span class="n">custom_xticklabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span> <span class="o">=</span> <span class="n">color_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_mapping</span> <span class="o">=</span> <span class="n">region_mapping</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processed_hdf5_folder</span><span class="p">,</span> <span class="n">region_mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_mapping</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Transmission.line_util"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_util">[docs]</a>    <span class="k">def</span> <span class="nf">line_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a timeseries line plot of transmission lineflow utilization for each region.</span>

<span class="sd">        Utilization is plotted between 0 and 1 on the y-axis.</span>
<span class="sd">        The plot will default to showing the 10 highest utilized lines. A Line category</span>
<span class="sd">        can also be passed instead, using the property field in the Marmot_plot_select.csv</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>

<span class="sd">        This methods calls _util() to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_util</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.line_hist"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_hist">[docs]</a>    <span class="k">def</span> <span class="nf">line_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a histogram of transmission lineflow utilization for each region.</span>

<span class="sd">        Utilization is plotted between 0 and 1 on the x-axis, with # lines on the y-axis.</span>
<span class="sd">        Each bar is equal to a 0.05 utilization rate</span>
<span class="sd">        The plot will default to showing all lines. A Line category can also be passed</span>
<span class="sd">        instead using the property field in the Marmot_plot_select.csv</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>

<span class="sd">        This methods calls _util() and passes the hist=True argument to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_util</span><span class="p">(</span><span class="n">hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_util</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates utilization plots, line plot and histograms</span>

<span class="sd">        This methods is called from line_util() and line_hist()</span>

<span class="sd">        Args:</span>
<span class="sd">            hist (bool, optional): If True creates a histogram of utilization.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            prop (str, optional): Optional PLEXOS line category to display.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># sets up x, y dimensions of plot</span>
        <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">set_facet_col_row_dimensions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">facet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multi_scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
        <span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">*</span> <span class="n">nrows</span>
        <span class="c1"># Used to calculate any excess axis to delete</span>
        <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For all lines touching Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

            <span class="c1"># Get and process all line limits</span>
            <span class="n">line_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_line_interface_limits</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">data_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># gets correct metadata based on area aggregation</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data to plot for scenario&quot;</span><span class="p">)</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                    <span class="k">continue</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="c1"># Limit to only lines touching to this zone</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                        <span class="n">flow</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;Scenario&quot;</span> <span class="ow">in</span> <span class="n">line_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">limits</span> <span class="o">=</span> <span class="n">line_limits</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">limits</span> <span class="o">=</span> <span class="n">line_limits</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

                <span class="c1"># Filters on specifed line category if prop is not None.</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line category = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Line category </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">, Not found in data! &quot;</span>
                            <span class="s2">&quot;All categories will be plotted.&quot;</span>
                        <span class="p">)</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
                <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;Util&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">/</span> <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># If greater than 1 because exceeds flow limit, report as 1</span>
                <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;Util&quot;</span><span class="p">][</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;Util&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">annual_util</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;Util&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># top annual utilized lines</span>
                <span class="n">top_utilization</span> <span class="o">=</span> <span class="n">annual_util</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>

                <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">mplt</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">annual_util</span><span class="p">,</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">scenario</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">top_utilization</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
                        <span class="n">level</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                        <span class="n">duration_curve</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">flow</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Util&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">duration_curve</span><span class="p">,</span> <span class="s2">&quot;Util&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>
                <span class="n">data_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annual_util</span><span class="p">)</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
            <span class="c1"># Remove extra axes</span>
            <span class="n">mplt</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>
            <span class="c1"># add facet labels</span>
            <span class="n">mplt</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">xlabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="n">prop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="s2">&quot;All Lines&quot;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
                    <span class="s2">&quot;Number of lines&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span>
                <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Line Utilization: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
                    <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="n">prop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="s2">&quot;Top 10 Lines&quot;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Line Utilization: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                    <span class="n">labelpad</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span>
                    <span class="s2">&quot;Intervals&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">Data_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">Data_Out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

    <span class="c1"># def int_flow_ind(self, figure_name: str = None, prop: str = None,</span>
    <span class="c1">#                  start_date_range: str = None,</span>
    <span class="c1">#                  end_date_range: str = None, **_):</span>
    <span class="c1">#     &quot;&quot;&quot;Creates a line plot of interchange flows and their import and export limits.</span>

    <span class="c1">#     Each interchange is potted on a separate facet plot.</span>
    <span class="c1">#     The plot includes every interchange that originates or ends in the aggregation zone.</span>
    <span class="c1">#     This can be adjusted by passing a comma separated string of interchanges to the property input.</span>

    <span class="c1">#     The code will create either a timeseries or duration curve depending on</span>
    <span class="c1">#     if the word &#39;duration_curve&#39; is in the figure_name.</span>
    <span class="c1">#     To make a duration curve, ensure the word &#39;duration_curve&#39; is found in the figure_name.</span>

    <span class="c1">#     Args:</span>
    <span class="c1">#         figure_name (str, optional): User defined figure output name.</span>
    <span class="c1">#             Defaults to None.</span>
    <span class="c1">#         prop (str, optional): Comma separated string of interchanges.</span>
    <span class="c1">#             Defaults to None.</span>
    <span class="c1">#         start_date_range (str, optional): Defines a start date at which to represent data from.</span>
    <span class="c1">#             Defaults to None.</span>
    <span class="c1">#         end_date_range (str, optional): Defines a end date at which to represent data to.</span>
    <span class="c1">#             Defaults to None.</span>

    <span class="c1">#     Returns:</span>
    <span class="c1">#         dict: dictionary containing the created plot and its data table</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     duration_curve=False</span>
    <span class="c1">#     if &#39;duration_curve&#39; in figure_name:</span>
    <span class="c1">#         duration_curve = True</span>

    <span class="c1">#     # List of properties needed by the plot, properties are a set of tuples and</span>
    <span class="c1">#     # contain 3 parts: required True/False, property name and scenarios required,</span>
    <span class="c1">#     # scenarios must be a list.</span>
    <span class="c1">#     properties = [(True,&quot;interface_Flow&quot;,self.Scenarios),</span>
    <span class="c1">#                   (True,&quot;interface_Import_Limit&quot;,self.Scenarios),</span>
    <span class="c1">#                   (True,&quot;interface_Export_Limit&quot;,self.Scenarios)]</span>

    <span class="c1">#     # Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
    <span class="c1">#     # with all required properties, returns a 1 if required data is missing</span>
    <span class="c1">#     check_input_data = self.get_formatted_data(properties)</span>

    <span class="c1">#     if 1 in check_input_data:</span>
    <span class="c1">#         return MissingInputData()</span>

    <span class="c1">#     scenario = self.Scenarios[0]</span>

    <span class="c1">#     outputs : dict = {}</span>

    <span class="c1">#     if pd.notna(start_date_range):</span>
    <span class="c1">#         logger.info(f&quot;Plotting specific date range: \</span>
    <span class="c1">#             {str(start_date_range)} to {str(end_date_range)}&quot;)</span>

    <span class="c1">#     for zone_input in self.Zones:</span>
    <span class="c1">#         logger.info(f&quot;For all interfaces touching Zone = {zone_input}&quot;)</span>

    <span class="c1">#         data_table_out = pd.DataFrame()</span>

    <span class="c1">#         # gets correct metadata based on area aggregation</span>
    <span class="c1">#         if self.AGG_BY==&#39;zone&#39;:</span>
    <span class="c1">#             zone_lines = self.meta.zone_lines(scenario)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             zone_lines = self.meta.region_lines(scenario)</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             zone_lines = zone_lines.set_index([self.AGG_BY])</span>
    <span class="c1">#         except:</span>
    <span class="c1">#             logger.info(&quot;Column to Aggregate by is missing&quot;)</span>
    <span class="c1">#             continue</span>

    <span class="c1">#         zone_lines = zone_lines.xs(zone_input)</span>
    <span class="c1">#         zone_lines = zone_lines[&#39;line_name&#39;].unique()</span>

    <span class="c1">#         #Map lines to interfaces</span>
    <span class="c1">#         all_ints = self.meta.interface_lines(scenario) #Map lines to interfaces</span>
    <span class="c1">#         all_ints.index = all_ints.line</span>
    <span class="c1">#         ints = all_ints.loc[all_ints.index.intersection(zone_lines)]</span>

    <span class="c1">#         #flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
    <span class="c1">#         #flow = flow.droplevel(&#39;interface_category&#39;)</span>

    <span class="c1">#         export_limits = self[&quot;interface_Export_Limit&quot;].get(scenario).copy().droplevel(&#39;timestamp&#39;)</span>
    <span class="c1">#         export_limits.mask(export_limits[0]==0.0,other=0.01,inplace=True) #if limit is zero set to small value</span>
    <span class="c1">#         export_limits = export_limits[export_limits.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)]</span>
    <span class="c1">#         export_limits = export_limits[export_limits[0].abs() &lt; 99998] #Filter out unenforced interfaces.</span>

    <span class="c1">#         #Drop unnecessary columns.</span>
    <span class="c1">#         export_limits.reset_index(inplace = True)</span>
    <span class="c1">#         export_limits.drop(columns=[&#39;interface_category&#39;, &#39;units&#39;], inplace=True)</span>
    <span class="c1">#         export_limits.set_index(&#39;interface_name&#39;,inplace = True)</span>

    <span class="c1">#         import_limits = self[&quot;interface_Import_Limit&quot;].get(scenario).copy().droplevel(&#39;timestamp&#39;)</span>
    <span class="c1">#         import_limits.mask(import_limits[0]==0.0,other=0.01,inplace=True) #if limit is zero set to small value</span>
    <span class="c1">#         import_limits = import_limits[import_limits.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)]</span>
    <span class="c1">#         import_limits = import_limits[import_limits[0].abs() &lt; 99998] #Filter out unenforced interfaces.</span>
    <span class="c1">#         reported_ints = import_limits.index.get_level_values(&#39;interface_name&#39;).unique()</span>

    <span class="c1">#         #Drop unnecessary columns.</span>
    <span class="c1">#         import_limits.reset_index(inplace = True)</span>
    <span class="c1">#         import_limits.drop(columns=[&#39;interface_category&#39;, &#39;units&#39;], inplace=True)</span>
    <span class="c1">#         import_limits.set_index(&#39;interface_name&#39;,inplace = True)</span>

    <span class="c1">#         #Extract time index</span>
    <span class="c1">#         ti = self[&quot;interface_Flow&quot;][self.Scenarios[0]].index.get_level_values(&#39;timestamp&#39;).unique()</span>

    <span class="c1">#         if prop:</span>
    <span class="c1">#             interf_list = prop.split(&#39;,&#39;)</span>
    <span class="c1">#             logger.info(&#39;Plotting only interfaces specified in Marmot_plot_select.csv&#39;)</span>
    <span class="c1">#             logger.info(interf_list)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             interf_list = reported_ints.copy()</span>

    <span class="c1">#         logger.info(&#39;Plotting full time series results.&#39;)</span>
    <span class="c1">#         xdim,ydim = set_x_y_dimension(len(interf_list))</span>

    <span class="c1">#         mplt = PlotLibrary(ydim, xdim, squeeze=False,</span>
    <span class="c1">#                            ravel_axs=True)</span>
    <span class="c1">#         fig, axs = mplt.get_figure()</span>

    <span class="c1">#         grid_size = xdim * ydim</span>
    <span class="c1">#         excess_axs = grid_size - len(interf_list)</span>
    <span class="c1">#         plt.subplots_adjust(wspace=0.05, hspace=0.2)</span>
    <span class="c1">#         missing_ints = 0</span>
    <span class="c1">#         chunks = []</span>
    <span class="c1">#         n = -1</span>
    <span class="c1">#         for interf in interf_list:</span>
    <span class="c1">#             n += 1</span>

    <span class="c1">#             #Remove leading spaces</span>
    <span class="c1">#             if interf[0] == &#39; &#39;:</span>
    <span class="c1">#                 interf = interf[1:]</span>
    <span class="c1">#             if interf in reported_ints:</span>
    <span class="c1">#                 chunks_interf = []</span>
    <span class="c1">#                 single_exp_lim = export_limits.loc[interf] / 1000 #TODO: Use auto unit converter</span>
    <span class="c1">#                 single_imp_lim = import_limits.loc[interf] / 1000</span>

    <span class="c1">#                 #Check if all hours have the same limit.</span>
    <span class="c1">#                 check = single_exp_lim.to_numpy()</span>
    <span class="c1">#                 identical = check[0] == check.all()</span>

    <span class="c1">#                 limits = pd.concat([single_exp_lim,single_imp_lim],axis = 1)</span>
    <span class="c1">#                 limits.columns = [&#39;export limit&#39;,&#39;import limit&#39;]</span>

    <span class="c1">#                 limits.index = ti</span>

    <span class="c1">#                 for scenario in self.Scenarios:</span>
    <span class="c1">#                     flow = self[&quot;interface_Flow&quot;].get(scenario)</span>
    <span class="c1">#                     single_int = flow.xs(interf, level=&#39;interface_name&#39;) / 1000</span>
    <span class="c1">#                     single_int.index = single_int.index.droplevel([&#39;interface_category&#39;,&#39;units&#39;])</span>
    <span class="c1">#                     single_int.columns = [interf]</span>
    <span class="c1">#                     single_int = single_int.reset_index().set_index(&#39;timestamp&#39;)</span>
    <span class="c1">#                     limits = limits.reset_index().set_index(&#39;timestamp&#39;)</span>

    <span class="c1">#                     if shift_leapday:</span>
    <span class="c1">#                         single_int = adjust_for_leapday(single_int)</span>
    <span class="c1">#                     if pd.notna(start_date_range):</span>
    <span class="c1">#                         single_int = single_int[start_date_range : end_date_range]</span>
    <span class="c1">#                         limits = limits[start_date_range : end_date_range]</span>
    <span class="c1">#                     if duration_curve:</span>
    <span class="c1">#                         single_int = sort_duration(single_int,interf)</span>

    <span class="c1">#                     mplt.lineplot(single_int, interf,</span>
    <span class="c1">#                                             label=f&quot;{scenario}\n interface flow&quot;,</span>
    <span class="c1">#                                             sub_pos=n)</span>

    <span class="c1">#                     # Only print limits if it doesn&#39;t change monthly or if you are plotting a time series.</span>
    <span class="c1">#                     # Otherwise the limit lines could be misleading.</span>
    <span class="c1">#                     if not duration_curve or identical[0]:</span>
    <span class="c1">#                         if scenario == self.Scenarios[-1]:</span>
    <span class="c1">#                             #Only plot limits for last scenario.</span>
    <span class="c1">#                             limits_color_dict = {&#39;export limit&#39;: &#39;red&#39;, &#39;import limit&#39;: &#39;green&#39;}</span>
    <span class="c1">#                             mplt.lineplot(limits, &#39;export limit&#39;,</span>
    <span class="c1">#                                                      label=&#39;export limit&#39;, color=limits_color_dict,</span>
    <span class="c1">#                                                      linestyle=&#39;--&#39;, sub_pos=n)</span>
    <span class="c1">#                             mplt.lineplot(limits, &#39;import limit&#39;,</span>
    <span class="c1">#                                                      label=&#39;import limit&#39;, color=limits_color_dict,</span>
    <span class="c1">#                                                      linestyle=&#39;--&#39;, sub_pos=n)</span>

    <span class="c1">#                     #For output time series .csv</span>
    <span class="c1">#                     scenario_names = pd.Series([scenario] * len(single_int), name=&#39;Scenario&#39;)</span>
    <span class="c1">#                     single_int_out = single_int.set_index([scenario_names], append=True)</span>
    <span class="c1">#                     chunks_interf.append(single_int_out)</span>

    <span class="c1">#                 Data_out_line = pd.concat(chunks_interf,axis = 0)</span>
    <span class="c1">#                 Data_out_line.columns = [interf]</span>
    <span class="c1">#                 chunks.append(Data_out_line)</span>

    <span class="c1">#             else:</span>
    <span class="c1">#                 logger.warning(f&quot;{interf} not found in results. Have you tagged &quot;</span>
    <span class="c1">#                                     &quot;it with the &#39;Must Report&#39; property in PLEXOS?&quot;)</span>
    <span class="c1">#                 excess_axs += 1</span>
    <span class="c1">#                 missing_ints += 1</span>
    <span class="c1">#                 continue</span>

    <span class="c1">#             axs[n].set_title(interf)</span>
    <span class="c1">#             if not duration_curve:</span>
    <span class="c1">#                 mplt.set_subplot_timeseries_format(sub_pos=n)</span>
    <span class="c1">#             if missing_ints == len(interf_list):</span>
    <span class="c1">#                 outputs = MissingInputData()</span>
    <span class="c1">#                 return outputs</span>

    <span class="c1">#         data_table_out = pd.concat(chunks,axis = 1)</span>
    <span class="c1">#         data_table_out = data_table_out.reset_index()</span>
    <span class="c1">#         index_name = &#39;level_0&#39; if duration_curve else &#39;timestamp&#39;</span>
    <span class="c1">#         data_table_out = data_table_out.pivot(index = index_name,columns = &#39;Scenario&#39;)</span>
    <span class="c1">#         #Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
    <span class="c1">#         #Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

    <span class="c1">#         # data_table_out = data_table_out.reset_index()</span>
    <span class="c1">#         # data_table_out = data_table_out.groupby(data_table_out.index // 24).mean()</span>
    <span class="c1">#         # data_table_out.index = pd.date_range(start = &#39;1/1/2024&#39;,end = &#39;12/31/2024&#39;,freq = &#39;D&#39;)</span>
    <span class="c1">#         mplt.add_legend()</span>
    <span class="c1">#         plt.ylabel(&#39;Flow (GW)&#39;,  color=&#39;black&#39;, rotation=&#39;vertical&#39;,</span>
    <span class="c1">#                    labelpad=30)</span>
    <span class="c1">#         if duration_curve:</span>
    <span class="c1">#             plt.xlabel(&#39;Sorted hour of the year&#39;, color=&#39;black&#39;, labelpad=30)</span>
    <span class="c1">#         plt.tight_layout(rect=[0, 0.03, 1, 0.97])</span>
    <span class="c1">#         if plot_data_settings[&quot;plot_title_as_region&quot;]:</span>
    <span class="c1">#             mplt.add_main_title(zone_input)</span>
    <span class="c1">#         outputs[zone_input] = {&#39;fig&#39;: fig, &#39;data_table&#39;: data_table_out}</span>
    <span class="c1">#         #Limits_Out.to_csv(self.figure_folder.joinpath(self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>
    <span class="c1">#     return outputs</span>

<div class="viewcode-block" id="Transmission.int_flow_ind_seasonal"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.int_flow_ind_seasonal">[docs]</a>    <span class="k">def</span> <span class="nf">int_flow_ind_seasonal</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;#TODO: Finish Docstring</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): User defined figure output name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            prop (str, optional): Comma separated string of interchanges.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Use auto unit converter in method</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For all interfaces touching Zone = &quot;</span> <span class="o">+</span> <span class="n">zone_input</span><span class="p">)</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># gets correct metadata based on area aggregation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># Map lines to interfaces</span>
            <span class="n">all_ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>  <span class="c1"># Map lines to interfaces</span>
            <span class="n">all_ints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">line</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_ints</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

            <span class="c1"># flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
            <span class="c1"># flow = flow.droplevel(&#39;interface_category&#39;)</span>

            <span class="n">export_limits</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
                <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span>
                <span class="n">export_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">ints</span><span class="o">.</span><span class="n">interface</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span>
                <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
            <span class="p">]</span>  <span class="c1"># Filter out unenforced interfaces.</span>

            <span class="c1"># Drop unnecessary columns.</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;interface_category&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">import_limits</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
                <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span>
                <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">ints</span><span class="o">.</span><span class="n">interface</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span>
                <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
            <span class="p">]</span>  <span class="c1"># Filter out unenforced interfaces.</span>
            <span class="n">reported_ints</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
                <span class="s2">&quot;interface_name&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># Drop unnecessary columns.</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;interface_category&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Extract time index</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">prop</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Plotting only interfaces specified in Marmot_plot_select.csv&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">reported_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Carving out season from &quot;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="n">end_date_range</span>
            <span class="p">)</span>

            <span class="c1"># Remove missing interfaces from the list.</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="c1"># Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">interf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reported_ints</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">interf</span> <span class="o">+</span> <span class="s2">&quot; not found in results.&quot;</span><span class="p">)</span>
                    <span class="n">interf_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">xdim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ydim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">missing_ints</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">chunks_interf</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
                <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

                <span class="c1"># Check if all hours have the same limit.</span>
                <span class="n">check</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">identical</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span> <span class="n">single_imp_lim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export limit&quot;</span><span class="p">,</span> <span class="s2">&quot;import limit&quot;</span><span class="p">]</span>
                <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

                <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                    <span class="n">single_int</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                    <span class="n">single_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;interface_category&quot;</span><span class="p">)</span>
                    <span class="n">single_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_int</span><span class="p">)</span>
                    <span class="n">summer</span> <span class="o">=</span> <span class="n">single_int</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                    <span class="n">winter</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                    <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                        <span class="n">summer</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">summer</span><span class="p">,</span> <span class="n">interf</span><span class="p">)</span>
                        <span class="n">winter</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">winter</span><span class="p">,</span> <span class="n">interf</span><span class="p">)</span>
                        <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">,</span> <span class="s2">&quot;export limit&quot;</span><span class="p">)</span>
                        <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">,</span> <span class="s2">&quot;export limit&quot;</span><span class="p">)</span>

                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">summer</span><span class="p">[</span><span class="n">interf</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">scenario</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> interface flow&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">winter</span><span class="p">[</span><span class="n">interf</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">scenario</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> interface flow&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">summer_lim</span><span class="p">:</span>
                            <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s2">&quot;export limit&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;import limit&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                            <span class="p">}</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                <span class="n">summer_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                <span class="n">winter_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                                <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                            <span class="p">)</span>

                    <span class="c1"># For output time series .csv</span>
                    <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_int</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                    <span class="p">)</span>
                    <span class="n">single_int_out</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">chunks_interf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_int_out</span><span class="p">)</span>

                <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_interf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">Data_out_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                    <span class="n">formatter</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">ConciseDateFormatter</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2"> %b&quot;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%b</span><span class="se">\n</span><span class="s2"> %Y&quot;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2"> %b&quot;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%H:%M</span><span class="se">\n</span><span class="s2"> </span><span class="si">%d</span><span class="s2">-%b&quot;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">offset_formats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%b %Y&quot;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">show_offset</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
            <span class="c1"># Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flow (GW)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sorted hour of the year&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.15</span><span class="p">,</span>
                <span class="mf">0.98</span><span class="p">,</span>
                <span class="s2">&quot;Summer (&quot;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="n">end_date_range</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s2">&quot;Winter&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>
            <span class="c1"># Limits_Out.to_csv(self.figure_folder.joinpath(self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="c1"># TODO: re-organize parameters (self vs. not self)</span>
<div class="viewcode-block" id="Transmission.int_flow_ind_diff"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.int_flow_ind_diff">[docs]</a>    <span class="k">def</span> <span class="nf">int_flow_ind_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot under development</span>

<span class="sd">        This method plots the hourly difference in interface flow between two scenarios for</span>
<span class="sd">        individual interfaces, with a facet for each interface.</span>
<span class="sd">        The two scenarios are defined in the &quot;scenario_diff&quot; row of Marmot_user_defined_inputs.</span>
<span class="sd">        The interfaces are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        The figure and data tables are saved within the module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            UnderDevelopment(): Exception class, plot is not functional.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UnderDevelopment</span><span class="p">()</span>  <span class="c1"># TODO: add new get_data method</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">check_input_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Flow_Collection</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Import_Limit_Collection</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Export_Limit_Collection</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">get_data</span><span class="p">(</span>
                    <span class="n">Flow_Collection</span><span class="p">,</span>
                    <span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">get_data</span><span class="p">(</span>
                    <span class="n">Import_Limit_Collection</span><span class="p">,</span>
                    <span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">get_data</span><span class="p">(</span>
                    <span class="n">Export_Limit_Collection</span><span class="p">,</span>
                    <span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For all interfaces touching Zone = &quot;</span> <span class="o">+</span> <span class="n">zone_input</span><span class="p">)</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># gets correct metadata based on area aggregation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># Map lines to interfaces</span>
            <span class="n">all_ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>  <span class="c1"># Map lines to interfaces</span>
            <span class="n">all_ints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">line</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_ints</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

            <span class="c1"># flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
            <span class="c1"># flow = flow.droplevel(&#39;interface_category&#39;)</span>

            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">Export_Limit_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
                <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span>
                <span class="n">export_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">ints</span><span class="o">.</span><span class="n">interface</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span>
                <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
            <span class="p">]</span>  <span class="c1"># Filter out unenforced interfaces.</span>

            <span class="c1"># Drop unnecessary columns.</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;interface_category&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">Import_Limit_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
                <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span>
                <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                    <span class="n">ints</span><span class="o">.</span><span class="n">interface</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span>
                <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
            <span class="p">]</span>  <span class="c1"># Filter out unenforced interfaces.</span>
            <span class="n">reported_ints</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span>
                <span class="s2">&quot;interface_name&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1"># Drop unnecessary columns.</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;interface_category&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Extract time index</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Flow_Collection</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Plotting only interfaces specified in Marmot_plot_select.csv&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">reported_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting full time series results.&quot;</span><span class="p">)</span>
            <span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">))</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">missing_ints</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">reported_ints</span><span class="p">:</span>
                    <span class="n">chunks_interf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
                    <span class="p">)</span>  <span class="c1"># TODO: Use auto unit converter in method</span>
                    <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

                    <span class="c1"># Check if all hours have the same limit.</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                    <span class="n">identical</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                    <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span> <span class="n">single_imp_lim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export limit&quot;</span><span class="p">,</span> <span class="s2">&quot;import limit&quot;</span><span class="p">]</span>

                    <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

                    <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="n">Flow_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span>
                            <span class="s2">&quot;interface_category&quot;</span>
                        <span class="p">)</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_int</span><span class="p">)</span>

                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
                        <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">):</span>

                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">]</span>
                            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">single_int</span><span class="p">,</span> <span class="n">interf</span><span class="p">)</span>

                        <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                            <span class="n">single_int</span><span class="p">,</span>
                            <span class="n">interf</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">scenario</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> interface flow&quot;</span><span class="p">,</span>
                            <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="c1"># Only print limits if it doesn&#39;t change monthly or if you are plotting a time series. Otherwise the limit lines could be misleading.</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span> <span class="ow">or</span> <span class="n">identical</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="c1"># Only plot limits for last scenario.</span>
                                <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s2">&quot;export limit&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;import limit&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                <span class="p">}</span>
                                <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                                    <span class="n">limits</span><span class="p">,</span>
                                    <span class="s2">&quot;export limit&quot;</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;export limit&quot;</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                                    <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                                    <span class="n">limits</span><span class="p">,</span>
                                    <span class="s2">&quot;import limit&quot;</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;import limit&quot;</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                                    <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                                <span class="p">)</span>

                        <span class="c1"># For output time series .csv</span>
                        <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_int</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                        <span class="p">)</span>
                        <span class="n">single_int_out</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>
                        <span class="n">chunks_interf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_int_out</span><span class="p">)</span>

                    <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_interf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">Data_out_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="n">interf</span>
                        <span class="o">+</span> <span class="s1">&#39; not found in results. Have you tagged it with the &quot;Must Report&quot; property in PLEXOS?&#39;</span>
                    <span class="p">)</span>
                    <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">missing_ints</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">missing_ints</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">):</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">data_table_out</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">index_name</span> <span class="o">=</span> <span class="s2">&quot;level_0&quot;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s2">&quot;timestamp&quot;</span>
            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">data_table_out</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
            <span class="c1"># Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
            <span class="c1"># Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

            <span class="c1"># data_table_out = data_table_out.reset_index()</span>
            <span class="c1"># data_table_out = data_table_out.groupby(data_table_out.index // 24).mean()</span>
            <span class="c1"># data_table_out.index = pd.date_range(start = &#39;1/1/2024&#39;,end = &#39;12/31/2024&#39;,freq = &#39;D&#39;)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flow (GW)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sorted hour of the year&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>
            <span class="c1"># Limits_Out.to_csv(self.figure_folder.joinpath(self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.interface_flow_ind"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.interface_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">interface_flow_ind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Individual_Interface_Flow&quot;</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Timeseries or duration curve of individual interfaces.</span>

<span class="sd">        This method plots flow, import and export limit, for individual</span>
<span class="sd">        transmission interfaces, with a facet for each interface.</span>
<span class="sd">        The interfaces are specified in the plot properties field of</span>
<span class="sd">        Marmot_plot_select.csv (column 4).</span>
<span class="sd">        Figures and data tables are saved within the method.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): Figure output name.</span>
<span class="sd">                Defaults to &quot;Individual_Interface_Flow&quot;.</span>
<span class="sd">            prop (str, optional): Used to pass in interface names.</span>
<span class="sd">                Input format should be a comma seperated string.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            **kwargs</span>
<span class="sd">                Any additional parameters will be passed to the _tx_flow_ind method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_flow_ind</span><span class="p">(</span>
            <span class="n">connection</span><span class="o">=</span><span class="s2">&quot;interface&quot;</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Transmission.line_flow_ind"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Individual_Line_Flow&quot;</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Timeseries or duration curve of individual lines.</span>

<span class="sd">        This method plots flow, import and export limit, for individual</span>
<span class="sd">        transmission lines, with a facet for each line.</span>
<span class="sd">        The lines are specified in the plot properties field of</span>
<span class="sd">        Marmot_plot_select.csv (column 4).</span>
<span class="sd">        Figures and data tables are saved within the method.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): Figure output name.</span>
<span class="sd">                Defaults to &quot;Individual_Line_Flow&quot;.</span>
<span class="sd">            prop (str, optional): Used to pass in line nams.</span>
<span class="sd">                Input format should be a comma seperated string.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            **kwargs</span>
<span class="sd">                Any additional parameters will be passed to the _tx_flow_ind method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx_flow_ind</span><span class="p">(</span>
            <span class="n">connection</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_tx_flow_ind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">connection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Timeseries or duration curve of individual lines or interfaces.</span>

<span class="sd">        This methods is called from int_flow_ind() and line_flow_ind()</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str): Figure output name.</span>
<span class="sd">            prop (str): Used to pass in line/interface names.</span>
<span class="sd">                Input format should be a comma seperated string.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to</span>
<span class="sd">                represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to</span>
<span class="sd">                represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Import_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Export_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting only </span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">s specified in Marmot_plot_select.csv&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">))</span>
        <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

        <span class="n">data_tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">chunks_line</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_name&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2"> not found in results. Have you tagged &quot;</span>
                        <span class="s2">&quot;it with the &#39;Must Report&#39; property in PLEXOS?&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

                <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;category&quot;</span> <span class="ow">in</span> <span class="n">single_line</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;interface_category&quot;</span> <span class="ow">in</span> <span class="n">single_line</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;interface_category&quot;</span><span class="p">)</span>

                <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">scenario</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                        <span class="n">single_line</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">single_line</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="n">chunks_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="c1"># For output time series.csv</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">scenario</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2"> Flow&quot;</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                <span class="p">)</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">line</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line_out</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario_names</span><span class="p">,</span> <span class="n">line_name</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">data_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">chunks_line</span><span class="p">:</span>
                <span class="n">line_flow_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_line</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

            <span class="c1"># Only convert on first lines</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                    <span class="n">line_flow_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="n">sum_values</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="n">line_flow_out</span> <span class="o">=</span> <span class="n">line_flow_out</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>

            <span class="n">legend_order</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Plot line flow</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">line_flow_out</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">line_flow_single</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">line_flow_out</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line_flow_single</span> <span class="o">=</span> <span class="n">line_flow_out</span>
                <span class="n">legend_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">line_flow_single</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                <span class="n">legend_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">legend_label</span><span class="p">)</span>

            <span class="c1"># Get and process all line limits</span>
            <span class="n">line_limits</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_line_interface_limits</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Export_Limit&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">connection</span><span class="si">}</span><span class="s2">_Import_Limit&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="n">line</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># Plot line limits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_line_interface_limits</span><span class="p">(</span><span class="n">line_limits</span><span class="p">,</span> <span class="n">mplt</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">duration_curve</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_tables</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">data_table_out</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="n">legend_order</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;Export Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;Import Limit&quot;</span><span class="p">])</span>
        <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span><span class="n">sort_by</span><span class="o">=</span><span class="n">legend_order</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Flow (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
            <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># plt.tight_layout()</span>
        <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Intervals&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s2">&quot;_duration_curve&quot;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">figure_name</span><span class="si">}{</span><span class="n">fn_suffix</span><span class="si">}</span><span class="s2">.svg&quot;</span>
            <span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">figure_name</span><span class="si">}{</span><span class="n">fn_suffix</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="Transmission.line_flow_ind_diff"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_flow_ind_diff">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring</span>

<span class="sd">        This method plots the flow difference for individual transmission lines, with a facet for each line.</span>
<span class="sd">        The scenarios are specified in the &quot;Scenario_Diff_plot&quot; field of Marmot_user_defined_inputs.csv.</span>
<span class="sd">        The lines are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        Figures and data tables are saved in the module.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): [description]. Defaults to None.</span>
<span class="sd">            prop (str, optional): [description]. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Use auto unit converter in method</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="c1"># Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_lines</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">InputSheetError</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting only lines specified in Marmot_plot_select.csv&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">flow_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_diff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span>
            <span class="s2">&quot;line_Flow&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">xdim</span><span class="p">,</span> <span class="n">ydim</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">))</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">reported_lines</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">missing_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reported_lines</span><span class="p">:</span>

                <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow_diff</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span>
                <span class="n">single_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">single_line</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                <span class="c1"># mplt.lineplot(single_line,line, label = self.scenario_diff[1] + &#39; - \n&#39; + self.scenario_diff[0] + &#39;\n line flow&#39;, sub_pos = n)</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                    <span class="n">single_line</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BESS - no BESS </span><span class="se">\n</span><span class="s2"> line flow&quot;</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">line</span>
                    <span class="o">+</span> <span class="s1">&#39; not found in results. Have you tagged it with the &quot;Must Report&quot; property in PLEXOS?&#39;</span>
                <span class="p">)</span>
                <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">missing_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_lines</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
            <span class="s2">&quot;Flow difference (MW)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s2">&quot;_duration_curve&quot;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s2">&quot;_transmission&quot;</span><span class="p">,</span> <span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s2">&quot;.svg&quot;</span>
            <span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s2">&quot;_transmission&quot;</span><span class="p">,</span> <span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.line_flow_ind_seasonal"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_flow_ind_seasonal">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind_seasonal</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: Finish Docstring.</span>

<span class="sd">        This method differs from the previous method, in that it plots seasonal line limits.</span>
<span class="sd">        To use this method, line import/export must be an &quot;interval&quot; property, not a &quot;year&quot; property.</span>
<span class="sd">        This can be selected in  &quot;plexos_properties.csv&quot;.</span>
<span class="sd">        Re-run the formatter if necessary, it will overwrite the existing properties in &quot;*_formatted.h5&quot;</span>

<span class="sd">        This method plots flow, import and export limit, for individual transmission lines, with a facet for each line.</span>
<span class="sd">        The lines are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        The plot includes every interchange that originates or ends in the aggregation zone.</span>
<span class="sd">        Figures and data tables saved in the module.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): [description]. Defaults to None.</span>
<span class="sd">            prop (str, optional): [description]. Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): [description]. Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): [description]. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Use auto unit converter in method</span>

        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;You are attempting to plot a time series facetted by two seasons,</span><span class="se">\n\</span>
<span class="s1">            but you are missing a value in the &quot;Start Date&quot; column of &quot;Marmot_plot_select.csv&quot; </span><span class="se">\</span>
<span class="s1">            Please enter dates in &quot;Start Date&quot; and &quot;End Date&quot;. These will define the bounds of </span><span class="se">\</span>
<span class="s1">            one of your two seasons. The other season will be comprised of the rest of the year.&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_lines</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting only lines specified in Marmot_plot_select.csv&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Line limits are seasonal.</span>
        <span class="n">export_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
        <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
            <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
        <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span>
            <span class="n">export_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
        <span class="p">]</span>  <span class="c1"># Filter out unenforced lines.</span>

        <span class="n">import_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
        <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
            <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># if limit is zero set to small value</span>
        <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span>
            <span class="n">import_limits</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span>
        <span class="p">]</span>  <span class="c1"># Filter out unenforced lines.</span>

        <span class="c1"># Extract time index</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">reported_lines</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Carving out season from &quot;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="n">end_date_range</span>
        <span class="p">)</span>

        <span class="c1"># Remove missing interfaces from the list.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="c1"># Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reported_lines</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot; not found in results.&quot;</span><span class="p">)</span>
                <span class="n">select_lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">xdim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">missing_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">chunks_line</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>
            <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="n">single_imp_lim</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

            <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span> <span class="n">single_imp_lim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export limit&quot;</span><span class="p">,</span> <span class="s2">&quot;import limit&quot;</span><span class="p">]</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>
            <span class="n">limits_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
                <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">)</span>
                <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">)</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">single_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="c1"># Split into seasons.</span>
                <span class="n">summer</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                <span class="n">winter</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">summer</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">summer</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">winter</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">winter</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">,</span> <span class="s2">&quot;export limit&quot;</span><span class="p">)</span>
                    <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">,</span> <span class="s2">&quot;export limit&quot;</span><span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">summer</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">scenario</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> line flow&quot;</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">winter</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">scenario</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> line flow&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">summer_lim</span><span class="p">:</span>
                        <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;export limit&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;import limit&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                            <span class="n">summer_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                            <span class="n">winter_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
                            <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span>
                            <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="c1"># For output time series .csv</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                <span class="p">)</span>
                <span class="n">single_line_out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line_out</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">chunks_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

            <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_line</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_lines</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
        <span class="c1"># Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Summer (Jun - Sep)&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Winter (Jan - Mar,Oct - Dec)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flow (MW)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s2">&quot;_duration_curve&quot;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s2">&quot;_transmission&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Individual_Line_Flow&quot;</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s2">&quot;_seasonal.svg&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s2">&quot;_transmission&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Individual_Line_Flow&quot;</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s2">&quot;_seasonal.csv&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Limits_Out.to_csv(self.figure_folder.joinpath(self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Line_Limits.csv&#39;))</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_grab_zone_net_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone_input</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">interconnect_aggby</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">fxnaggregator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span>

        <span class="c1"># what is the interconnect for this zone?</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">interconnect_aggby</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interconnect_aggby</span><span class="p">:</span>
            <span class="n">Stacked_Gen_A</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="s2">&quot;generator_Generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">Stacked_Gen_A</span> <span class="o">=</span> <span class="n">Stacked_Gen_A</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Stacked_Gen_A</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">fxnaggregator</span> <span class="o">=</span> <span class="s2">&quot;Interconnection&quot;</span>
            <span class="n">zone_input</span> <span class="o">=</span> <span class="n">Stacked_Gen_A</span><span class="p">[</span><span class="n">Stacked_Gen_A</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">][</span>
                <span class="n">fxnaggregator</span>
            <span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">Stacked_Gen</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="s2">&quot;generator_Generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">Stacked_Gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span><span class="p">(</span>
                    <span class="n">Stacked_Gen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span>
                <span class="p">)</span>
            <span class="n">Stacked_Gen</span> <span class="o">=</span> <span class="n">Stacked_Gen</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">fxnaggregator</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No generation in </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="n">Stacked_Gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_process_gen_inputs</span><span class="p">(</span><span class="n">Stacked_Gen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_gen</span><span class="p">)</span>

        <span class="n">curtailment_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_names_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Curtailment&quot;</span><span class="p">,</span> <span class="s2">&quot;Curtailment&quot;</span><span class="p">)</span>
        <span class="c1"># print(self.mplot_data_dict[f&quot;generator_Curtailment&quot;].get(scenario).copy())</span>
        <span class="c1"># Insert Curtailmnet into gen stack if it exhists in database</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;generator_</span><span class="si">{</span><span class="n">curtailment_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]:</span>
            <span class="n">Stacked_Curt</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;generator_</span><span class="si">{</span><span class="n">curtailment_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">Stacked_Curt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span><span class="p">(</span>
                    <span class="n">Stacked_Curt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">zone_input</span>
                <span class="ow">in</span> <span class="n">Stacked_Curt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">fxnaggregator</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">Stacked_Curt</span> <span class="o">=</span> <span class="n">Stacked_Curt</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">fxnaggregator</span><span class="p">)</span>
                <span class="n">Stacked_Curt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_process_gen_inputs</span><span class="p">(</span>
                    <span class="n">Stacked_Curt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_gen</span>
                <span class="p">)</span>
                <span class="n">Stacked_Curt</span> <span class="o">=</span> <span class="n">Stacked_Curt</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">Stacked_Curt</span><span class="p">[</span><span class="n">Stacked_Curt</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Remove values less than 0.05 MW</span>
                <span class="n">Stacked_Gen</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">Stacked_Gen</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
                    <span class="n">column</span><span class="o">=</span><span class="n">curtailment_name</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">Stacked_Curt</span><span class="p">,</span>
                <span class="p">)</span>  <span class="c1"># Insert curtailment into</span>
                <span class="c1"># Calculates Net Load by removing variable gen + curtailment</span>
                <span class="n">vre_gen_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_categories</span><span class="o">.</span><span class="n">vre</span> <span class="o">+</span> <span class="p">[</span><span class="n">curtailment_name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vre_gen_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_categories</span><span class="o">.</span><span class="n">vre</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">vre_gen_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_categories</span><span class="o">.</span><span class="n">vre</span>
        <span class="c1"># vre_gen_cat = self.gen_categories.vre</span>
        <span class="n">vre_gen_cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vre_gen_cat</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Stacked_Gen</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="n">Net_Load</span> <span class="o">=</span> <span class="n">Stacked_Gen</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">vre_gen_cat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Net_Load</span> <span class="o">=</span> <span class="n">Net_Load</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Net_Load</span><span class="p">,</span> <span class="n">zone_input</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">line_scatter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timezone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

        <span class="c1"># assert prop in [&#39;Generation&#39;,&#39;Curtailment&#39;,&#39;Pump_Load&#39;,&#39;Load&#39;,&#39;Unserved_Energy&#39;, &#39;Net_Interchange&#39;]</span>

        <span class="c1"># return self.UnderDevelopment()</span>
        <span class="c1"># then we can rank-order the hours based on the thing we wish to facet on</span>
        <span class="n">facet</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;Facet&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">facet</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>

        <span class="k">def</span> <span class="nf">set_dicts</span><span class="p">(</span><span class="n">scenario_list</span><span class="p">):</span>

            <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
            <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;generator_Generation&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
                <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;generator_Curtailment&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
                <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;generator_Pump_Load&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
                <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Load&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
                <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Unserved_Energy&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
                <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Net_Interchange&quot;</span><span class="p">,</span> <span class="n">scenario_list</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="c1"># Runs get_data to populate mplot_data_dict with all required properties, returns a 1 if required data is missing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span>
            <span class="p">)</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">facet</span><span class="p">:</span>
            <span class="n">check_input_data</span> <span class="o">=</span> <span class="n">set_dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_input_data</span> <span class="o">=</span> <span class="n">set_dicts</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># here we get the hour and season groups?</span>
        <span class="n">categorize_hours</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">categorize_hours</span><span class="p">:</span>
            <span class="n">scenario_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">tmpstmps</span> <span class="o">=</span> <span class="n">scenario_0</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">tmpstmps</span><span class="p">})</span>  <span class="c1"># get to a df</span>
            <span class="n">tmp_df</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
                <span class="n">tmp_df</span><span class="o">.</span><span class="n">timestamp</span>
            <span class="p">)</span>  <span class="c1"># ensure are as datetimes</span>
            <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>  <span class="c1"># pull hour</span>
            <span class="n">begin_onpeak</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">end_onpeak</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;on-peak (HB </span><span class="si">{</span><span class="n">begin_onpeak</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_onpeak</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="k">if</span> <span class="n">begin_onpeak</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">end_onpeak</span>
                <span class="k">else</span> <span class="s2">&quot;off-peak&quot;</span>
            <span class="p">)</span>  <span class="c1"># make categories as desired</span>

        <span class="c1"># here we can record the system-wide net load by scenario</span>

        <span class="c1"># for scenario in self.Scenarios:</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         all_gen = self.mplot_data_dict[&#39;generator_Generation&#39;].get(scenario).copy()</span>
        <span class="c1">#         if self.shift_leapday is True:</span>
        <span class="c1">#             all_gen = self.shift_leapday(all_gen,self.Marmot_Solutions_folder)</span>
        <span class="c1">#         # Stacked_Gen = Stacked_Gen.xs(zone_input,level=self.AGG_BY)</span>
        <span class="c1">#     except KeyError:</span>
        <span class="c1">#         self.logger.warning(f&#39;No generation... probably some problem&#39;)</span>
        <span class="c1">#         out = MissingZoneData()</span>
        <span class="c1">#         return out</span>
        <span class="c1">#     for z in all_gen.index.get_level_values(self.AGG_BY).unique():</span>
        <span class="c1">#         print(z)</span>
        <span class="c1">#         print(self._grab_zone_net_load(z,scenario))</span>
        <span class="c1">#         print(type(self._grab_zone_net_load(z,scenario)))</span>
        <span class="c1"># try to concat? Use scenario pointers?</span>

        <span class="c1"># split the props to see if we want net load</span>
        <span class="n">use_net_load</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">interconnect_net_load</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Net&quot;</span> <span class="ow">or</span> <span class="n">prop</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;net&quot;</span><span class="p">:</span>
                    <span class="n">use_net_load</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">prop</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">prop</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
                    <span class="n">interconnect_net_load</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># here we can grab interchange</span>
        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">data_table_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_net_load</span><span class="p">:</span>
                    <span class="n">net_load</span><span class="p">,</span> <span class="n">label_addenda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grab_zone_net_load</span><span class="p">(</span>
                        <span class="n">zone_input</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">interconnect_aggby</span><span class="o">=</span><span class="n">interconnect_net_load</span>
                    <span class="p">)</span>

                <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">scenario</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span><span class="p">(</span><span class="n">rr_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">)</span>
                <span class="c1"># may need to check agg here if not zone or region</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;region&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                    <span class="n">agg_region_mapping</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">region_mapping</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]]</span>
                        <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="c1"># Checks if keys all aggregate to a single value, this plot requires multiple values to work</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UnsupportedAggregation</span><span class="p">()</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>

                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;flow (MW)&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="n">parent_region</span> <span class="o">=</span> <span class="p">[</span><span class="n">zone_input</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parent_region</span><span class="p">:</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="p">[</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parent</span><span class="p">]</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                        <span class="n">index</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;flow (MW)&quot;</span>
                    <span class="p">)</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">:,</span> <span class="p">(</span><span class="n">single_parent</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="p">]</span>  <span class="c1"># Remove all 0 columns (uninteresting).</span>
                    <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                        <span class="p">)</span>  <span class="c1"># Remove columns if parent = child</span>
                    <span class="c1"># single_parent = single_parent / unitconversion[&#39;divisor&#39;]</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_parent</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                <span class="p">)</span>
                <span class="c1"># data_table = single_parent.add_suffix(f&quot; ({unitconversion[&#39;units&#39;]})&quot;)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># great, now we can match against something</span>
                <span class="c1"># eventually probably want this to be able to aggregate all zones</span>
                <span class="c1"># and do things other than load</span>

                <span class="c1"># lookup_label = f&#39;{agg}_Load&#39;#&quot;generator_Generation&quot;#f&#39;{agg}_Load&#39;</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="ow">or</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Unserved_Energy&quot;</span><span class="p">:</span>
                    <span class="n">lookup_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Net_Interchange&quot;</span><span class="p">:</span>
                    <span class="n">lookup_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lookup_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;generator_</span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">lookup_label</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;generator&quot;</span> <span class="ow">in</span> <span class="n">lookup_label</span><span class="p">:</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="n">lookup_label</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">Load</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">Load</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Load</span><span class="p">[</span><span class="s2">&quot;tech&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="n">Load</span><span class="p">[</span><span class="n">Load</span><span class="p">[</span><span class="s2">&quot;tech&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="n">Load</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">lookup_label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="n">lookup_label</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span><span class="p">(</span><span class="n">Load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Net_Interchange&quot;</span>
                <span class="p">):</span>  <span class="c1"># want a second prop to tell what to replace?</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="n">Load</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s2">&quot;PJM-W&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                    <span class="n">lookup_label</span> <span class="o">=</span> <span class="n">lookup_label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;PJM-W&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lookup_label is </span><span class="si">{</span><span class="n">lookup_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Load</span> <span class="o">=</span> <span class="n">Load</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                <span class="n">Load</span> <span class="o">=</span> <span class="n">Load</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="c1"># do a comparison that could allow switching to net load?</span>
                <span class="c1"># print(&#39;my comparison!!!&#39;)</span>
                <span class="c1"># print(Load)</span>
                <span class="c1"># print(net_load)</span>
                <span class="c1"># print(type(net_load))</span>
                <span class="c1"># print(net_load.tolist())</span>
                <span class="c1"># print(Load.squeeze())</span>

                <span class="k">if</span> <span class="n">use_net_load</span><span class="p">:</span>
                    <span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;sort_attribute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_load</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_table</span><span class="p">[</span><span class="s2">&quot;sort_attribute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Load</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">label_addenda</span> <span class="o">=</span> <span class="n">zone_input</span>

                <span class="n">data_table_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

                <span class="c1"># sorted_data_table = data_table.sort_values([&#39;sort_attribute&#39;],ascending = False)</span>
                <span class="c1"># data_avgs.append(sorted_data_table.mean(axis=0))</span>
                <span class="c1"># data_table_chunks.append(sorted_data_table.iloc[:int(len(sorted_data_table.index)*top_pct),:])</span>
                <span class="c1"># data_table_chunks.append(data_table)</span>

            <span class="c1"># can we recategorize?</span>
            <span class="k">if</span> <span class="n">categorize_hours</span> <span class="ow">and</span> <span class="n">use_net_load</span><span class="p">:</span>
                <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;net_load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_load</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;pct_rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;net_load&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">pct</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">pct_cut</span> <span class="o">=</span> <span class="mf">0.98</span>
                <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;RA hour (top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pct_cut</span><span class="p">))</span><span class="si">}</span><span class="s2">% of </span><span class="si">{</span><span class="n">label_addenda</span><span class="si">}</span><span class="s2"> net load hours)&quot;</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">pct_cut</span>
                    <span class="k">else</span> <span class="s2">&quot;non-RA hour&quot;</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tmp_df</span><span class="p">[</span><span class="s2">&quot;pct_rank&quot;</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="c1"># tmp_df[&#39;hour&#39;].apply(lambda x: f&#39;on-peak (HB {begin_onpeak}-{end_onpeak})&#39; if begin_onpeak&lt;x&lt;=end_onpeak else &#39;off-peak&#39;) # make categories as desired</span>

            <span class="n">zone_interchange_timeseries</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="n">data_table_chunks</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>
            <span class="c1"># create and bank unit conversions</span>
            <span class="n">line_unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">line_unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># zone_interchange_avgs = pd.concat(data_avgs, copy=False, axis=0)</span>
            <span class="n">attr_unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">attr_unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Make a facet plot, one panel for each child zone.</span>
            <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="n">plot_number</span><span class="p">)</span>
            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdimension</span> <span class="o">*</span> <span class="n">ydimension</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>
            <span class="n">fig3</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

            <span class="c1"># then have a flag for whether you want to use them to set color of scatter</span>

            <span class="n">color_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span>  <span class="c1"># [&#39;r&#39;,&#39;g&#39;,&#39;y&#39;,&#39;b&#39;,&#39;o&#39;]</span>

            <span class="c1"># try it also as a scatter</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">categorize_hours</span><span class="p">:</span>
                    <span class="c1"># run a join</span>
                    <span class="n">zone_interchange_timeseries_wcategories</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">zone_interchange_timeseries</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">color_list</span><span class="p">))</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                        <span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                        <span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span><span class="s2">&quot;sort_attribute&quot;</span><span class="p">],</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                            <span class="n">color_dict</span>
                        <span class="p">),</span>
                        <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                        <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> Flow (</span><span class="si">{</span><span class="n">line_unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">lookup_label</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">use_net_load</span> <span class="ow">and</span> <span class="s2">&quot;net&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lookup_label</span><span class="p">:</span>
                        <span class="n">split_label</span> <span class="o">=</span> <span class="n">lookup_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">split_label</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;net&quot;</span><span class="p">)</span>
                        <span class="n">lookup_label</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split_label</span><span class="p">)</span>

                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lookup_label</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">label_addenda</span><span class="si">}</span><span class="s2"> - (</span><span class="si">{</span><span class="n">attr_unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">tmp_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">date1</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span>
                    <span class="n">date2</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;5min intervals for </span><span class="si">{</span><span class="n">date1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">date2</span><span class="si">}</span><span class="s2"> plotted&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span>
                    <span class="p">)</span>
                    <span class="c1"># subset before doing polyfit</span>
                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
                        <span class="n">zone_interchange_timeseries_wcategories_subset</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span>
                                <span class="n">zone_interchange_timeseries_wcategories</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span>
                            <span class="n">zone_interchange_timeseries_wcategories_subset</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                            <span class="n">zone_interchange_timeseries_wcategories_subset</span><span class="p">[</span>
                                <span class="s2">&quot;sort_attribute&quot;</span>
                            <span class="p">],</span>
                            <span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                            <span class="n">zone_interchange_timeseries_wcategories_subset</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                            <span class="n">p</span><span class="p">(</span><span class="n">zone_interchange_timeseries_wcategories_subset</span><span class="p">[</span><span class="n">column</span><span class="p">]),</span>
                            <span class="n">c</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">cat</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                        <span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                        <span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="s2">&quot;sort_attribute&quot;</span><span class="p">],</span>
                        <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                        <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> Flow (</span><span class="si">{</span><span class="n">line_unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lookup_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">attr_unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span>
                    <span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span>
                        <span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                        <span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="s2">&quot;sort_attribute&quot;</span><span class="p">],</span>
                        <span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="n">column</span><span class="p">],</span>
                        <span class="n">p</span><span class="p">(</span><span class="n">zone_interchange_timeseries</span><span class="p">[</span><span class="n">column</span><span class="p">]),</span>
                        <span class="s2">&quot;r--&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># TODO # season split, how to mark lines, legend, T/F input for using categorize_hours, iteration thru wind, solar, load, etc. with single input</span>

            <span class="c1"># this actually seems too complicated for now</span>
            <span class="c1"># then iterate across the child zones, plotting relevant info</span>
            <span class="c1"># for n,column in enumerate(zone_interchange_timeseries.columns[:-1]):</span>

            <span class="c1">#     self.create_line_plot(axs,zone_interchange_timeseries.reset_index(),column,label=column,n=n)</span>

            <span class="c1">#     ax2 = axs[n].twinx()</span>
            <span class="c1">#     ax2.plot(zone_interchange_timeseries.reset_index()[&#39;sort_attribute&#39;], color=&#39;red&#39;, label=&#39;sort_attribute&#39;)</span>
            <span class="c1">#     axs[n].axhline(y = zone_interchange_avgs[column], ls = &#39;--&#39;,label = f&#39;{column} avg&#39;,color = &#39;blue&#39;)</span>
            <span class="c1">#     ax2.axhline(y = zone_interchange_avgs[&#39;sort_attribute&#39;], ls = &#39;--&#39;,label = &#39;attr avg&#39;,color = &#39;red&#39;)</span>

            <span class="c1">#     axs[n].set_title(f&quot;{zone_input} to {column}&quot;)</span>
            <span class="c1">#     axs[n].yaxis.set_major_formatter(mpl.ticker.FuncFormatter(lambda x, p: format(x, f&#39;,.{self.y_axes_decimalpt}f&#39;)))</span>
            <span class="c1">#     axs[n].margins(x=0.01)</span>
            <span class="c1">#     axs[n].set_xlabel(&#39;Rank in timeseries&#39;)</span>
            <span class="c1">#     axs[n].set_ylabel(&#39;Flow (MW)&#39;,color=&#39;blue&#39;,fontsize=12)</span>
            <span class="c1">#     ax2.set_ylabel(&quot;Load (MW)&quot;,color=&quot;red&quot;,fontsize=12)</span>

            <span class="c1">#     axs[n].set_xlim([0,int(len(zone_interchange_timeseries.index)*1.2)]) #extend</span>
            <span class="c1">#     ax2.set_xlim([0,int(len(zone_interchange_timeseries.index)*1.2)]) #extend</span>

            <span class="c1"># add labels</span>
            <span class="c1"># for line,label in zip(axs[n].lines, ax1_labs):</span>
            <span class="c1">#     y = line.get_ydata()[-1]</span>
            <span class="c1">#     x = line.get_xdata()[-1]</span>
            <span class="c1">#     axs[n].annotate(label, xy=(1,y), xytext=(.82*x,0), color=line.get_color(),</span>
            <span class="c1">#                 xycoords = axs[n].get_yaxis_transform(), textcoords=&quot;offset points&quot;,</span>
            <span class="c1">#                 size=12, va=&quot;center&quot;)</span>

            <span class="c1"># for line,label in zip(ax2.lines, ax2_labs):</span>
            <span class="c1">#     y = line.get_ydata()[-1]</span>
            <span class="c1">#     x = line.get_xdata()[-1]</span>
            <span class="c1">#     ax2.annotate(label, xy=(.8,y), xytext=(.82*x,0), color=line.get_color(),</span>
            <span class="c1">#                 xycoords = ax2.get_yaxis_transform(), textcoords=&quot;offset points&quot;,</span>
            <span class="c1">#                 size=12, va=&quot;center&quot;)</span>

            <span class="c1"># axs[n].legend(loc=&#39;lower left&#39;,bbox_to_anchor=(1,0), facecolor=&#39;inherit&#39;, frameon=True)</span>

            <span class="c1"># clean empty and resize</span>
            <span class="c1"># Remove extra axes</span>
            <span class="k">if</span> <span class="n">excess_axs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig3</span><span class="p">,</span>
                <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">zone_interchange_timeseries</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span>
        <span class="c1"># return self.UnderDevelopment()</span>

    <span class="k">def</span> <span class="nf">_overwrite_line_limits_from_minmax_flows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">overwrite_properties</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrites line_Import_Limit and line_Export_Limit for a given scenario</span>
<span class="sd">        with the max and min flows (respectively) on the line</span>
<span class="sd">        min flows are negative by convention</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scenario : str</span>
<span class="sd">            name of scenario with missing export/import limits to ovewrite</span>
<span class="sd">        overwrite_properties : list</span>
<span class="sd">            column names of export/import limits to be ovewritten</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of pandas.DataFrame</span>
<span class="sd">            each data frame has timeseries fo new export and import limits for each line</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="nb">property</span> <span class="ow">in</span> <span class="n">overwrite_properties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">property</span><span class="si">}</span><span class="s2"> is being overwritten in </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2"> in this method by using line_Flow min/max&quot;</span>
            <span class="p">)</span>
        <span class="n">flow_reset_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">flow_maxes</span> <span class="o">=</span> <span class="n">flow_reset_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">flow_mins</span> <span class="o">=</span> <span class="n">flow_reset_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">maxes_merge</span> <span class="o">=</span> <span class="n">flow_reset_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flow_maxes</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">maxes_merge</span> <span class="o">=</span> <span class="n">maxes_merge</span><span class="p">[[</span><span class="s2">&quot;timestamp_x&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="s2">&quot;0_y&quot;</span><span class="p">]]</span>  <span class="c1"># subset</span>
        <span class="n">maxes_merge</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;timestamp_x&quot;</span><span class="p">:</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;0_y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">maxes_merge</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">mins_merge</span> <span class="o">=</span> <span class="n">flow_reset_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flow_mins</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">mins_merge</span> <span class="o">=</span> <span class="n">mins_merge</span><span class="p">[[</span><span class="s2">&quot;timestamp_x&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="s2">&quot;0_y&quot;</span><span class="p">]]</span>  <span class="c1"># subset</span>
        <span class="n">mins_merge</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;timestamp_x&quot;</span><span class="p">:</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;0_y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mins_merge</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">maxes_merge</span><span class="p">,</span> <span class="n">mins_merge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_tx_cap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timezone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">unique_label_limit</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="c1"># return self.UnderDevelopment() #TODO: Needs finishing</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
            <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">properties_lines</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_data to populate mplot_data_dict with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">,</span> <span class="n">properties_lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span>
        <span class="p">)</span>
        <span class="n">overwrite_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
            <span class="c1"># self.logger.info(scenario)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">overwrite_input_data</span><span class="p">:</span>
                <span class="n">import_lim</span><span class="p">,</span> <span class="n">export_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_line_limits_from_minmax_flows</span><span class="p">(</span>
                    <span class="n">scenario</span><span class="p">,</span> <span class="n">overwrite_properties</span><span class="o">=</span><span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">import_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">][</span>
                    <span class="n">scenario</span>
                <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">export_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mplot_data_dict</span><span class="p">[</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">][</span>
                    <span class="n">scenario</span>
                <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="n">grouped_import_lims</span> <span class="o">=</span> <span class="n">import_lim</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">grouped_export_lims</span> <span class="o">=</span> <span class="n">export_lim</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># convert values to appropriate units?</span>
            <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span>
                    <span class="n">grouped_import_lims</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                    <span class="n">grouped_export_lims</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_interregionallines</span><span class="p">()</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>

                <span class="n">import_line_cap</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="n">grouped_import_lims</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                <span class="p">)</span>
                <span class="n">import_line_cap</span> <span class="o">=</span> <span class="n">import_line_cap</span><span class="p">[</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="p">]</span>  <span class="c1"># .set_index(&#39;region&#39;)</span>
                <span class="n">import_line_cap</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">import_line_cap</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
                    <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="n">export_line_cap</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="n">grouped_export_lims</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                <span class="p">)</span>
                <span class="n">export_line_cap</span> <span class="o">=</span> <span class="n">export_line_cap</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
                <span class="n">export_line_cap</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_line_cap</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
                    <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">import_line_cap</span><span class="p">,</span> <span class="n">export_line_cap</span><span class="p">])</span>
                <span class="n">data_table_out</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table_out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;line_name&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;line_capacity (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">data_table_out</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;import&quot;</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;export&quot;</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_table_out</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;line_capacity (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">]</span>
                <span class="p">]</span>

                <span class="c1"># subgroup if too many lines for plotting</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">import_line_cap</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">unique_label_limit</span>
                    <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">export_line_cap</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">unique_label_limit</span>
                <span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;more than </span><span class="si">{</span><span class="n">unique_label_limit</span><span class="si">}</span><span class="s2"> lines in </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">, so grouping by voltage_label for lines with kVs&quot;</span>
                    <span class="p">)</span>
                    <span class="n">import_line_cap</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">import_line_cap</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([^_]*_)</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;kV&quot;</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">else</span> <span class="n">a</span>
                    <span class="p">)</span>
                    <span class="n">import_line_cap</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">import_line_cap</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">])</span>
                        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">export_line_cap</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_line_cap</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([^_]*_)</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;kV&quot;</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">else</span> <span class="n">a</span>
                    <span class="p">)</span>
                    <span class="n">export_line_cap</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">export_line_cap</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">])</span>
                        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="p">)</span>

                <span class="n">import_line_cap</span> <span class="o">=</span> <span class="n">import_line_cap</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">export_line_cap</span> <span class="o">=</span> <span class="n">export_line_cap</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>

                <span class="c1"># get unique names of lines to create custom legend</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">import_line_cap</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="n">export_line_cap</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">l1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="c1"># make a colormap for each unique line</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">lut</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
                <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>

                <span class="n">fig1</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

                <span class="c1"># left panel</span>
                <span class="n">import_line_cap</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span><span class="p">),</span>
                    <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">color_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">import_line_cap</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
                <span class="p">)</span>  <span class="c1"># eventually you want to stack plot capacity by scenario</span>

                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Import capacity in region (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s2">f&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

                <span class="c1"># right panel</span>
                <span class="n">export_line_cap</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span><span class="p">),</span>
                    <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">color_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">export_line_cap</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
                <span class="p">)</span>  <span class="c1"># eventually you want to stack plot capacity by scenario</span>

                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Export capacity in region (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s2">f&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

                <span class="c1"># create custom line legend</span>
                <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="n">line_legend</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span>
                    <span class="p">)</span>
                    <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_legend</span><span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                    <span class="nb">reversed</span><span class="p">(</span><span class="n">handles</span><span class="p">),</span>
                    <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span>
                    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
                    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># add labels to panels</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="s2">&quot;A.&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">},</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span>
                <span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="s2">&quot;B.&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">},</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span>
                <span class="p">)</span>

                <span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span>
                    <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

                <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig1</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="Transmission.region_region_interchange_all_scenarios"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.region_region_interchange_all_scenarios">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_interchange_all_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring</span>

<span class="sd">        This method creates a timeseries line plot of interchange flows between the selected region</span>
<span class="sd">        to each connecting region.</span>
<span class="sd">        If there are more than 4 total interchanges, all other interchanges are aggregated into an &#39;other&#39; grouping</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>
<span class="sd">        Figures and data tables are returned to plot_main</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_region_interchange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.region_region_interchange_all_regions"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.region_region_interchange_all_regions">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_interchange_all_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring</span>

<span class="sd">        This method creates a timeseries line plot of interchange flows between the selected region</span>
<span class="sd">        to each connecting region. All regions are plotted on a single figure with each focus region placed on a separate</span>
<span class="sd">        facet plot</span>
<span class="sd">        If there are more than 4 total interchanges, all other interchanges are aggregated into an &#39;other&#39; grouping</span>
<span class="sd">        This figure only plots a single scenario that is defined by Main_scenario_plot in user_defined_inputs.csv.</span>
<span class="sd">        Figures and data tables are saved within method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_region_interchange</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">plot_scenario</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_region_region_interchange</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scenario_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plot_scenario</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;#TODO: Finish Docstring</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario_type (str): [description]</span>
<span class="sd">            plot_scenario (bool, optional): [description]. Defaults to True.</span>
<span class="sd">            timezone (str, optional): [description]. Defaults to &quot;&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># if &#39;duration_curve&#39; in figure_name:</span>
        <span class="c1">#     duration_curve=True</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">,</span> <span class="n">scenario_type</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">set_facet_col_row_dimensions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">multi_scenario</span><span class="o">=</span><span class="n">scenario_type</span>
            <span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="n">data_table_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenario_type</span><span class="p">:</span>

                <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">rr_int</span><span class="p">)</span>

                <span class="c1"># For plot_main handeling - need to find better solution</span>
                <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
                        <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;region&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                    <span class="n">agg_region_mapping</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">region_mapping</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]]</span>
                        <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="c1"># Checks if keys all aggregate to a single value, this plot requires multiple values to work</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>

                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="s2">&quot;flow (MW)&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="c1"># If plotting all regions update plot setup</span>
                <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># Make a facet plot, one panel for each parent zone.</span>
                    <span class="n">parent_region</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_region</span><span class="p">)</span>
                    <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="n">plot_number</span><span class="p">)</span>
                    <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parent_region</span> <span class="o">=</span> <span class="p">[</span><span class="n">zone_input</span><span class="p">]</span>
                    <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario_type</span><span class="p">)</span>

                <span class="n">grid_size</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">*</span> <span class="n">nrows</span>
                <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parent_region</span><span class="p">:</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="p">[</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parent</span><span class="p">]</span>

                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                        <span class="n">index</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;flow (MW)&quot;</span>
                    <span class="p">)</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="p">:,</span> <span class="p">(</span><span class="n">single_parent</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="p">]</span>  <span class="c1"># Remove all 0 columns (uninteresting).</span>
                    <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                        <span class="p">)</span>  <span class="c1"># Remove columns if parent = child</span>

                    <span class="c1"># Neaten up lines: if more than 4 total interchanges, aggregated all but the highest 3.</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="c1"># Set the &quot;three highest zonal interchanges&quot; for all three scenarios.</span>
                        <span class="n">cols_dontagg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">single_parent</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">abs</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">index</span>
                        <span class="p">)</span>
                        <span class="n">df_dontagg</span> <span class="o">=</span> <span class="n">single_parent</span><span class="p">[</span><span class="n">cols_dontagg</span><span class="p">]</span>
                        <span class="n">df_toagg</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_dontagg</span><span class="p">)</span>
                        <span class="n">agged</span> <span class="o">=</span> <span class="n">df_toagg</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">df_dontagg</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dontagg</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span> <span class="n">agged</span><span class="p">)</span>
                        <span class="n">single_parent</span> <span class="o">=</span> <span class="n">df_dontagg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                    <span class="c1"># Convert units</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                            <span class="n">single_parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
                        <span class="p">)</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

                        <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">single_parent</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                        <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span>
                            <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">xmin</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">xmax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
                        <span class="p">)</span>  <span class="c1"># Add horizontal line at 0.</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Create data table for each scenario</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_parent</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                <span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="c1"># if plotting all scenarios add facet labels</span>
            <span class="k">if</span> <span class="n">plot_scenario</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">xlabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">)</span>

            <span class="c1"># Remove extra axes</span>
            <span class="n">mplt</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Net Interchange (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If plotting all regions save output and return none plot_main</span>
            <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># Location to save to</span>
                <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">rr_int_agg</span>
                <span class="n">save_figures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s2">&quot;_transmission&quot;</span>
                <span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">save_figures</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                        <span class="s2">&quot;Region_Region_Interchange_</span><span class="si">{}</span><span class="s2">.svg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">),</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                    <span class="n">save_figures</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                        <span class="s2">&quot;Region_Region_Interchange_</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">Data_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_table_chunks</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># if plotting all scenarios return figures to plot_main</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">Data_Out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="Transmission.region_region_checkerboard"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.region_region_checkerboard">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_checkerboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a checkerboard/heatmap figure showing total interchanges between regions/zones.</span>

<span class="sd">        Each scenario is plotted on its own facet plot.</span>
<span class="sd">        Plots and Data are saved within the module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">))</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">*</span> <span class="n">nrows</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>

        <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">max_flow_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Data_Out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
            <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                <span class="n">rr_int</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">rr_int</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;region&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                <span class="n">agg_region_mapping</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">region_mapping</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]]</span>
                    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># Checks if keys all aggregate to a single value, this plot requires multiple values to work</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
                <span class="n">rr_int</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
                <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="s2">&quot;flow (MW)&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">rr_int_agg</span><span class="p">[</span><span class="s2">&quot;flow (MW)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.01</span>
            <span class="p">]</span>  <span class="c1"># Keep only positive flows</span>
            <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;flow (MW)&quot;</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># MWh -&gt; GWh</span>

            <span class="n">data_out</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data_out</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;flow (MW)&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> flow (GWh)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scenario</span><span class="p">)},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="n">max_flow</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s2">&quot;flow (MW)&quot;</span><span class="p">])</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;child&quot;</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">current_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>
            <span class="n">current_cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

            <span class="c1"># Rotate the tick labels and set their alignment.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
                <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Delineate the boxes and make room at top and bottom</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">max_flow_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_flow</span><span class="p">)</span>
            <span class="n">Data_Out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_out</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Remove extra axes</span>
        <span class="n">mplt</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">max_flow_group</span><span class="p">))</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span>
            <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total Net Interchange [GWh]&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;To Region&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;From Region&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">Data_Out</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">save_figures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="n">save_figures</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;region_region_checkerboard.svg&quot;</span><span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_figures</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;region_region_checkerboard.csv&quot;</span><span class="p">))</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.line_violations_timeseries"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_violations_timeseries">[docs]</a>    <span class="k">def</span> <span class="nf">line_violations_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a timeseries line plot of lineflow violations for each region.</span>

<span class="sd">        The magnitude of each violation is plotted on the y-axis</span>
<span class="sd">        Each sceanrio is plotted as a separate line.</span>

<span class="sd">        This methods calls _violations() to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_violations</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.line_violations_totals"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.line_violations_totals">[docs]</a>    <span class="k">def</span> <span class="nf">line_violations_totals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a barplot of total lineflow violations for each region.</span>

<span class="sd">        Each sceanrio is plotted as a separate bar.</span>

<span class="sd">        This methods calls _violations() and passes the total_violations=True argument</span>
<span class="sd">        to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_violations</span><span class="p">(</span><span class="n">total_violations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_violations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">total_violations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates line violation plots, line plot and barplots</span>

<span class="sd">        This methods is called from line_violations_timeseries() and line_violations_totals()</span>

<span class="sd">        Args:</span>
<span class="sd">            total_violations (bool, optional): If True finds the sum of violations.</span>
<span class="sd">                Used to create barplots. Defaults to False.</span>
<span class="sd">            timezone (str, optional): The timezone to display on the x-axes.</span>
<span class="sd">                Defaults to &quot;&quot;.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Violation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">scenario_df_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="n">line_v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Violation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="n">line_v</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                        <span class="n">line_v</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">line_v</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="n">line_v</span> <span class="o">=</span> <span class="n">line_v</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">viol</span> <span class="o">=</span> <span class="n">line_v</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
                    <span class="n">viol</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;zone&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">viol</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="n">one_zone</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                <span class="n">one_zone</span> <span class="o">=</span> <span class="n">one_zone</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">scenario</span><span class="p">})</span>
                <span class="n">one_zone</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">one_zone</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
                <span class="p">)</span>  <span class="c1"># We don&#39;t care the direction of the violation</span>
                <span class="n">scenario_df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one_zone</span><span class="p">)</span>

            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">scenario_df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># remove columns that are all equal to 0</span>
            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">all_scenarios</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                <span class="n">all_scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
            <span class="p">)</span>
            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">all_scenarios</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">total_violations</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">all_scenarios_tot</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="c1"># Set x-tick labels</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_xticklabels</span><span class="p">:</span>
                    <span class="n">tick_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tick_labels</span> <span class="o">=</span> <span class="n">all_scenarios_tot</span><span class="o">.</span><span class="n">index</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
                    <span class="n">all_scenarios_tot</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">,</span>
                    <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">custom_tick_labels</span><span class="o">=</span><span class="n">tick_labels</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">all_scenarios</span><span class="p">:</span>
                    <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                        <span class="n">all_scenarios</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">column</span>
                    <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Line violations (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="Transmission.net_export"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.net_export">[docs]</a>    <span class="k">def</span> <span class="nf">net_export</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;creates a timeseries net export line graph.</span>

<span class="sd">        Scenarios are plotted as separate lines.</span>

<span class="sd">        Args:</span>
<span class="sd">            timezone (str, optional): The timezone to display on the x-axes.</span>
<span class="sd">                Defaults to &quot;&quot;.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s2">&quot;zone&quot;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Net_Interchange&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">net_export_chunks</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">net_export_read</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">net_export_read</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">net_export_read</span><span class="p">)</span>

                <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export_read</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">scenario</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="n">net_export</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                        <span class="n">net_export</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">net_export</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="n">net_export_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_export</span><span class="p">)</span>

            <span class="n">net_export_all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_export_chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                <span class="n">net_export_all_scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
            <span class="p">)</span>
            <span class="n">net_export_all_scenarios</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">net_export_all_scenarios</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># Data table of values to return to main program</span>
            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Make scenario/color dictionary.</span>
            <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">net_export_all_scenarios</span><span class="p">:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                    <span class="n">net_export_all_scenarios</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">color_dict</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">column</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Net exports (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">()</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span><span class="n">reverse_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.zonal_interchange"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.zonal_interchange">[docs]</a>    <span class="k">def</span> <span class="nf">zonal_interchange</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;zonal_interchange&quot;</span><span class="p">,</span>
        <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">_</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a line plot of the net interchange between each zone, with a facet for each zone.</span>

<span class="sd">        The method will only work if agg_by = &quot;zone&quot;.</span>

<span class="sd">        The code will create either a timeseries or duration curve depending on</span>
<span class="sd">        if the word &#39;duration_curve&#39; is in the figure_name.</span>
<span class="sd">        To make a duration curve, ensure the word &#39;duration_curve&#39; is found in the figure_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): User defined figure output name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zone&quot;</span><span class="p">,</span> <span class="s2">&quot;zones&quot;</span><span class="p">,</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span> <span class="s2">&quot;Zones&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This plot only supports aggregation zone&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>

        <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;duration_curve&quot;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># sets up x, y dimensions of plot</span>
        <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">set_facet_col_row_dimensions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">multi_scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
        <span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">*</span> <span class="n">nrows</span>

        <span class="c1"># Used to calculate any excess axis to delete</span>
        <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ravel_axs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">net_exports_all</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">exp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_exporting_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="n">imp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_importing_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exp_lines</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">imp_lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MissingMetaData</span><span class="p">()</span>

                <span class="n">exp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">]</span>
                <span class="n">imp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">]</span>

                <span class="c1"># Find list of lines that connect each region.</span>
                <span class="n">exp_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>
                <span class="n">imp_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>

                <span class="n">other_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zones</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">other_zones</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Are you sure you set agg_by = zone?&quot;</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">shift_leapday</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">other_zone</span> <span class="ow">in</span> <span class="n">other_zones</span><span class="p">:</span>
                    <span class="n">exp_other_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>
                    <span class="n">imp_other_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>

                    <span class="n">exp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">exp_oz</span><span class="p">,</span> <span class="n">imp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                    <span class="p">)</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">imp_oz</span><span class="p">,</span> <span class="n">exp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                    <span class="p">)</span>

                    <span class="c1"># Swap columns for importing lines</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">imp_pair</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;region_from&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="s2">&quot;region_to&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exp_pair</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">])]</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">imp_pair</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">])]</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1"># Check for situations where there are only exporting or importing lines for this zonal pair.</span>
                    <span class="k">if</span> <span class="n">imports</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span>
                    <span class="k">elif</span> <span class="n">export</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="o">-</span><span class="n">imports</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span> <span class="o">-</span> <span class="n">imports</span>
                    <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">other_zone</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                            <span class="n">net_export</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">net_export</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">sort_duration</span><span class="p">(</span><span class="n">net_export</span><span class="p">,</span> <span class="n">other_zone</span><span class="p">)</span>

                    <span class="n">net_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_export</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">net_exports</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="p">[</span><span class="s2">&quot;Net export&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># unitconversion based off peak export hour, only checked once</span>
                <span class="k">if</span> <span class="n">zone_input</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                        <span class="n">net_exports</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
                    <span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">net_exports</span><span class="p">:</span>
                    <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span> <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s2">&quot;Net export&quot;</span> <span class="k">else</span> <span class="s2">&quot;solid&quot;</span>
                    <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                        <span class="n">net_exports</span><span class="p">,</span>
                        <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                        <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="c1"># Add horizontal line at 0.</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">mplt</span><span class="o">.</span><span class="n">set_subplot_timeseries_format</span><span class="p">(</span><span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

                <span class="c1"># Add scenario column to output table.</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">net_exports</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                <span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">net_exports_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_exports</span><span class="p">)</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">xlabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">)</span>
            <span class="n">mplt</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
            <span class="c1"># Remove extra axes</span>
            <span class="n">mplt</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Net export (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sorted Interval&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports_all</span><span class="p">)</span>
            <span class="c1"># if plotting all scenarios return figures to plot_main</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.zonal_interchange_total"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.zonal_interchange_total">[docs]</a>    <span class="k">def</span> <span class="nf">zonal_interchange_total</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a barplot of the net interchange between each zone, separated by positive and negative flows.</span>

<span class="sd">        The method will only work if agg_by = &quot;zone&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zone&quot;</span><span class="p">,</span> <span class="s2">&quot;zones&quot;</span><span class="p">,</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span> <span class="s2">&quot;Zones&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This plot only supports aggregation zone&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">outputs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

            <span class="n">net_exports_all</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Holds each scenario output table</span>
            <span class="n">data_out_chunk</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>

                <span class="n">exp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_exporting_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="n">imp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_importing_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exp_lines</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">imp_lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MissingMetaData</span><span class="p">()</span>

                <span class="n">exp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">]</span>
                <span class="n">imp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">]</span>

                <span class="c1"># Find list of lines that connect each region.</span>
                <span class="n">exp_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>
                <span class="n">imp_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>

                <span class="n">other_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zones</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">other_zones</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">other_zone</span> <span class="ow">in</span> <span class="n">other_zones</span><span class="p">:</span>
                    <span class="n">exp_other_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>
                    <span class="n">imp_other_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>

                    <span class="n">exp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">exp_oz</span><span class="p">,</span> <span class="n">imp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                    <span class="p">)</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">imp_oz</span><span class="p">,</span> <span class="n">exp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;line_name&quot;</span>
                    <span class="p">)</span>

                    <span class="c1"># Swap columns for importing lines</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">imp_pair</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;region_from&quot;</span><span class="p">,</span> <span class="s2">&quot;line_name&quot;</span><span class="p">,</span> <span class="s2">&quot;region_to&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exp_pair</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">])]</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">imp_pair</span><span class="p">[</span><span class="s2">&quot;line_name&quot;</span><span class="p">])]</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1"># Check for situations where there are only exporting or importing lines for this zonal pair.</span>
                    <span class="k">if</span> <span class="n">imports</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span>
                    <span class="k">elif</span> <span class="n">export</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="o">-</span><span class="n">imports</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span> <span class="o">-</span> <span class="n">imports</span>
                    <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">other_zone</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                            <span class="n">net_export</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">net_export</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>
                    <span class="n">net_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_export</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">net_exports</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="p">[</span><span class="s2">&quot;Net Export&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">positive</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">negative</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

                <span class="n">both</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">positive</span><span class="p">,</span> <span class="n">negative</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">both</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Total Export&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Import&quot;</span><span class="p">]</span>

                <span class="c1"># unitconversion based off peak export hour, only checked once</span>
                <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                        <span class="n">both</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">both</span> <span class="o">=</span> <span class="n">both</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
                <span class="n">net_exports_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">both</span><span class="p">)</span>

                <span class="c1"># Add scenario column to output table.</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">both</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">both</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">data_out_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_out_chunk</span><span class="p">)</span>

            <span class="c1"># Make scenario/color dictionary.</span>
            <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

            <span class="n">mplt</span><span class="o">.</span><span class="n">clustered_stacked_barplot</span><span class="p">(</span>
                <span class="n">net_exports_all</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="n">color_dict</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Interchange (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">h)&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_data_settings</span><span class="p">[</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">]:</span>
                <span class="n">mplt</span><span class="o">.</span><span class="n">add_main_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fig&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;data_table&quot;</span><span class="p">:</span> <span class="n">data_table_out</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.total_int_flow_ind"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.total_int_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">total_int_flow_ind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a clustered barplot of the total flow for a specific interface, separated by positive and negative flows.</span>

<span class="sd">        Specify the interface(s) of interest by providing a comma separated</span>
<span class="sd">        string to the property entry.</span>
<span class="sd">        Scenarios are clustered together as different colored bars.</span>
<span class="sd">        If multiple interfaces are provided, each will be plotted as a</span>
<span class="sd">        separate group of clustered bar.</span>

<span class="sd">        Args:</span>
<span class="sd">            prop (str): Comma separated string of interfaces to plot.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and</span>
        <span class="c1"># contain 3 parts: required True/False, property name and scenarios required,</span>
        <span class="c1"># scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>

        <span class="c1"># Runs get_formatted_data within PlotDataStoreAndProcessor to populate PlotDataStoreAndProcessor dictionary</span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># Select only interfaces specified in Marmot_plot_select.csv.</span>
        <span class="n">select_ints</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_ints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting only the interfaces specified in Marmot_plot_select.csv&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_ints</span><span class="p">)</span>

        <span class="n">mplt</span> <span class="o">=</span> <span class="n">PlotLibrary</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">mplt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">net_flows_all</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds each scenario output table</span>
        <span class="n">data_out_chunk</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">flow_all</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
            <span class="n">both_chunk</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">available_inter</span> <span class="o">=</span> <span class="n">select_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">select_ints</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow_all</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;interface_name&quot;</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">inter</span><span class="si">}</span><span class="s2"> Not in Data&quot;</span><span class="p">)</span>
                    <span class="n">available_inter</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Remove leading spaces</span>
                <span class="k">if</span> <span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                    <span class="n">inter</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow_all</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;interface_name&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="n">set_timestamp_date_range</span><span class="p">(</span>
                        <span class="n">flow</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">,</span> <span class="n">end_date_range</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No data in selected Date Range&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span>

                <span class="n">pos_sing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Total Export&quot;</span><span class="p">)</span>
                <span class="n">neg_sing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flow</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Total Import&quot;</span><span class="p">)</span>
                <span class="n">both_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pos_sing</span><span class="p">,</span> <span class="n">neg_sing</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">both_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">both_df</span><span class="p">)</span>

            <span class="n">both</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">both_chunk</span><span class="p">)</span>
            <span class="n">both</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Total Export&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Import&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">unitconversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span>
                    <span class="n">both</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span>
                <span class="p">)</span>

            <span class="n">both</span> <span class="o">=</span> <span class="n">both</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="n">both</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">available_inter</span>
            <span class="n">net_flows_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">both</span><span class="p">)</span>

            <span class="c1"># Add scenario column to output table.</span>
            <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">both</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
            <span class="n">data_table</span> <span class="o">=</span> <span class="n">both</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">data_out_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

        <span class="n">data_table_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_out_chunk</span><span class="p">)</span>

        <span class="c1"># Make scenario/color dictionary.</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

        <span class="n">mplt</span><span class="o">.</span><span class="n">clustered_stacked_barplot</span><span class="p">(</span>
            <span class="n">net_flows_all</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="n">color_dict</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
            <span class="s2">&quot;Flow (</span><span class="si">{}</span><span class="s2">h)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]),</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span> <span class="s2">&quot;Individual_Interface_Total_Flow.svg&quot;</span>
            <span class="p">),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data_table_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span> <span class="s2">&quot;Individual_Interface_Total_Flow.csv&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="Transmission.get_line_interface_limits"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.get_line_interface_limits">[docs]</a>    <span class="k">def</span> <span class="nf">get_line_interface_limits</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">extra_property_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">object_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get and process line and interface limits</span>

<span class="sd">        Gets limits for all scenarios.</span>
<span class="sd">        If limits are equal across all scenarios, only retunrs a single set of limts</span>
<span class="sd">        else returns limits for each scenario.</span>

<span class="sd">        Args:</span>
<span class="sd">            extra_property_names (list): list of limit property names.</span>
<span class="sd">            object_name (str, optional): Name of line or interface if only a single</span>
<span class="sd">                object is needed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: dataframe of limts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_data_frames</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ext_prop</span> <span class="ow">in</span> <span class="n">extra_property_names</span><span class="p">:</span>
            <span class="n">scen_chunk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">ext_prop</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">object_name</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                            <span class="n">object_name</span><span class="p">,</span>
                            <span class="n">level</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="s2">&quot;_name&quot;</span> <span class="ow">in</span> <span class="n">n</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="c1"># Filter out unenforced lines/interfaces.</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">ext_prop</span><span class="p">})</span>
                    <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">scenario_names</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">scen_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="n">all_scenario_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">scen_chunk</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">all_scenario_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">date_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
                    <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2010-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span>
                <span class="p">)</span>
                <span class="n">extra_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">date_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">ext_prop</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compare_limits</span> <span class="o">=</span> <span class="n">all_scenario_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">compare_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">compare_limits</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">scen</span> <span class="o">=</span> <span class="n">all_scenario_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">extra_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">all_scenario_data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">scen</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extra_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_scenario_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">extra_data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Transmission.plot_line_interface_limits"><a class="viewcode-back" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.Transmission.html#marmot.plottingmodules.transmission.Transmission.plot_line_interface_limits">[docs]</a>    <span class="k">def</span> <span class="nf">plot_line_interface_limits</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">limits</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">mplt</span><span class="p">:</span> <span class="n">PlotLibrary</span><span class="p">,</span>
        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">duration_curve</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Plots line/interface limits on a subplot</span>

<span class="sd">        Args:</span>
<span class="sd">            limits (pd.DataFrame): dataframe of import/export limits with a timeseries</span>
<span class="sd">            mplt (PlotLibrary): Instance of PlotLibrary</span>
<span class="sd">            n (int): Counter for subplots</span>
<span class="sd">            duration_curve (bool, optional): When potting a duration curve.</span>
<span class="sd">                If True, uses the max of the limit values.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limits_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Export&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">limits</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Import&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="p">):</span>

            <span class="n">limits_dict</span><span class="p">[</span><span class="s2">&quot;Export Limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Export&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">limits_dict</span><span class="p">[</span><span class="s2">&quot;Import Limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;Import&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">limit_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">limits_dict</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;Scenario&quot;</span> <span class="ow">in</span> <span class="n">limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                        <span class="n">limit_values</span> <span class="o">=</span> <span class="n">limits_dict</span><span class="p">[</span><span class="n">limit_type</span><span class="p">]</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                            <span class="n">scenario</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;Scenario&quot;</span>
                        <span class="p">)</span>
                        <span class="n">legend_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">limit_type</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">limit_values</span> <span class="o">=</span> <span class="n">limits_dict</span><span class="p">[</span><span class="n">limit_type</span><span class="p">]</span>
                        <span class="n">legend_label</span> <span class="o">=</span> <span class="n">limit_type</span>

                    <span class="k">if</span> <span class="n">limit_values</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">duration_curve</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span>
                            <span class="n">limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="p">):</span>
                            <span class="n">mplt</span><span class="o">.</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
                                <span class="n">y</span><span class="o">=</span><span class="n">limit_values</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">l</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">mplt</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
                                <span class="n">limit_values</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">l</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">,</span>
                                <span class="n">sub_pos</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                            <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;Scenario&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="k">continue</span></div></div>
</pre></div>

              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, Alliance for Sustainable Energy, LLC.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>