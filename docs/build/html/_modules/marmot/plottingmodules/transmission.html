<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>marmot.plottingmodules.transmission &mdash; Marmot 0.9.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Marmot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get-started/index.html">Get Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/install.html">Install the Marmot software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/format-tutorial.html">Tutorial: Formatting PLEXOS modelling results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/plot-tutorial.html">Tutorial: Creating Plots and Data-Tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/index.html">How-to Guides</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot-gallery/index.html">Plotting Examples Gallery</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../references/index.html">References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../references/input-files/files.html">Input File Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../references/input-files/Marmot_user_defined_inputs.html">Marmot_user_defined_inputs: csv file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/input-files/plexos_properties.html">plexos_properties: csv file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/input-files/Marmot_plot_select.html">Marmot_plot_select: csv file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/input-files/mapping-folder/index.html">Mapping Folder</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../references/input-files/mapping-folder/gen_names.html">gen_names: csv file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/input-files/mapping-folder/ordered_gen_categories.html">ordered_gen_categories: csv file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/input-files/mapping-folder/emit_names.html">emit_names: csv file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/input-files/mapping-folder/colour_dictionary.html">colour_dictionary: csv file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/input-files/mapping-folder/region_mapping.html">region_mapping: csv file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../references/code/modules.html">Code Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../references/code/modules.html#initialization-code">Initialization Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.marmot_h5_formatter.html">marmot.marmot_h5_formatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.marmot_plot_main.html">marmot.marmot_plot_main</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.meta_data.html">marmot.meta_data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/code/modules.html#config-package">Config Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.config.mconfig.html">marmot.config.mconfig</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/code/modules.html#plotting-modules-package">Plotting Modules Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.capacity_factor.html">marmot.plottingmodules.capacity_factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.capacity_out.html">marmot.plottingmodules.capacity_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.curtailment.html">marmot.plottingmodules.curtailment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.emissions.html">marmot.plottingmodules.emissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.generation_stack.html">marmot.plottingmodules.generation_stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.generation_unstack.html">marmot.plottingmodules.generation_unstack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.hydro.html">marmot.plottingmodules.hydro</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.prices.html">marmot.plottingmodules.prices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.production_cost.html">marmot.plottingmodules.production_cost</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.ramping.html">marmot.plottingmodules.ramping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.reserves.html">marmot.plottingmodules.reserves</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.sensitivities.html">marmot.plottingmodules.sensitivities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.storage.html">marmot.plottingmodules.storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.thermal_cap_reserve.html">marmot.plottingmodules.thermal_cap_reserve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.thermal_cap_reserve.html">marmot.plottingmodules.thermal_cap_reserve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.total_generation.html">marmot.plottingmodules.total_generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.total_installed_capacity.html">marmot.plottingmodules.total_installed_capacity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.transmission.html">marmot.plottingmodules.transmission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.unserved_energy.html">marmot.plottingmodules.unserved_energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.utilization_factor.html">marmot.plottingmodules.utilization_factor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../references/code/modules.html#plot-utility-package">Plot Utility Package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.plotutils.plot_data_helper.html">marmot.plottingmodules.plotutils.plot_data_helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.plotutils.plot_exceptions.html">marmot.plottingmodules.plotutils.plot_exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../references/code/_autosummary/marmot.plottingmodules.plotutils.plot_library.html">marmot.plottingmodules.plotutils.plot_library</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Marmot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>marmot.plottingmodules.transmission</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for marmot.plottingmodules.transmission</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created April 2020, updated August 2020</span>

<span class="sd">This code creates transmission line and interface plots.</span>
<span class="sd">@author: Daniel Levie, Marty Schwarz</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>

<span class="kn">import</span> <span class="nn">marmot.config.mconfig</span> <span class="k">as</span> <span class="nn">mconfig</span>
<span class="kn">import</span> <span class="nn">marmot.plottingmodules.plotutils.plot_library</span> <span class="k">as</span> <span class="nn">plotlib</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.plot_data_helper</span> <span class="kn">import</span> <span class="n">PlotDataHelper</span>
<span class="kn">from</span> <span class="nn">marmot.plottingmodules.plotutils.plot_exceptions</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MissingInputData</span><span class="p">,</span> <span class="n">DataSavedInModule</span><span class="p">,</span>
            <span class="n">UnderDevelopment</span><span class="p">,</span> <span class="n">InputSheetError</span><span class="p">,</span> <span class="n">MissingMetaData</span><span class="p">,</span> <span class="n">UnsupportedAggregation</span><span class="p">,</span> <span class="n">MissingZoneData</span><span class="p">)</span>


<div class="viewcode-block" id="MPlot"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot">[docs]</a><span class="k">class</span> <span class="nc">MPlot</span><span class="p">(</span><span class="n">PlotDataHelper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marmot MPlot class, common across all plotting modules.</span>

<span class="sd">    All the plotting modules use this same class name.</span>
<span class="sd">    This class contains plotting methods that are grouped based on the</span>
<span class="sd">    current module name.</span>
<span class="sd">    </span>
<span class="sd">    The transmission.py module contains methods that are</span>
<span class="sd">    related to the transmission network. </span>
<span class="sd">    </span>
<span class="sd">    MPlot inherits from the PlotDataHelper class to assist in creating figures.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MPlot init method</span>

<span class="sd">        Args:</span>
<span class="sd">            argument_dict (dict): Dictionary containing all</span>
<span class="sd">                arguments passed from MarmotPlot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># iterate over items in argument_dict and set as properties of class</span>
        <span class="c1"># see key_list in Marmot_plot_main for list of properties</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">argument_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">argument_dict</span><span class="p">[</span><span class="n">prop</span><span class="p">])</span>
        
        <span class="c1"># Instantiation of MPlotHelperFunctions</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered_gen</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">PLEXOS_color_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylabels</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">xlabels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_names_dict</span><span class="p">,</span> <span class="n">Region_Mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Region_Mapping</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;marmot_plot.&#39;</span><span class="o">+</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;axes_options&quot;</span><span class="p">,</span><span class="s2">&quot;y_axes_decimalpt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_defaults</span> <span class="o">=</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;font_settings&quot;</span><span class="p">)</span>
        

<div class="viewcode-block" id="MPlot.line_util"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_util">[docs]</a>    <span class="k">def</span> <span class="nf">line_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a timeseries line plot of transmission lineflow utilization for each region.</span>

<span class="sd">        Utilization is plotted between 0 and 1 on the y-axis.</span>
<span class="sd">        The plot will default to showing the 10 highest utilized lines. A Line category </span>
<span class="sd">        can also be passed instead, using the property field in the Marmot_plot_select.csv</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>

<span class="sd">        This methods calls _util() to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_util</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.line_hist"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_hist">[docs]</a>    <span class="k">def</span> <span class="nf">line_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a histogram of transmission lineflow utilization for each region.</span>

<span class="sd">        Utilization is plotted between 0 and 1 on the x-axis, with # lines on the y-axis.</span>
<span class="sd">        Each bar is equal to a 0.05 utilization rate</span>
<span class="sd">        The plot will default to showing all lines. A Line category can also be passed</span>
<span class="sd">        instead using the property field in the Marmot_plot_select.csv</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>

<span class="sd">        This methods calls _util() and passes the hist=True argument to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_util</span><span class="p">(</span><span class="n">hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
              <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
              <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates utilization plots, line plot and histograms</span>

<span class="sd">        This methods is called from line_util() and line_hist()</span>

<span class="sd">        Args:</span>
<span class="sd">            hist (bool, optional): If True creates a histogram of utilization. </span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            prop (str, optional): Optional PLEXOS line category to display.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1"># sets up x, y dimensions of plot</span>
        <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_facet_xy_dimensions</span><span class="p">(</span><span class="n">facet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                                                <span class="n">multi_scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdimension</span><span class="o">*</span><span class="n">ydimension</span>

        <span class="c1"># Used to calculate any excess axis to delete</span>
        <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For all lines touching Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span><span class="o">=</span><span class="n">xdimension</span><span class="p">,</span> 
                                           <span class="n">ydimension</span><span class="o">=</span><span class="n">ydimension</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

            <span class="n">data_table</span><span class="o">=</span><span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># gets correct metadata based on area aggregation</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="o">==</span><span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
                    <span class="n">zone_lines</span><span class="o">=</span><span class="n">zone_lines</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No data to plot for scenario&#39;</span><span class="p">)</span>
                    <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                    <span class="k">continue</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1">#Limit to only lines touching to this zone</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span> 

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

                <span class="n">limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>

                <span class="c1"># This checks for a nan in string. If no scenario selected, do nothing.</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line category = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">line_relations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;line_name&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span>
                    <span class="n">flow</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span><span class="n">line_relations</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                  <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">prop</span><span class="p">]</span>
                    <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span><span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;line_name&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">flow</span><span class="p">[</span><span class="s1">&#39;Util&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;0_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">/</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;0_y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1">#If greater than 1 because exceeds flow limit, report as 1</span>
                <span class="n">flow</span><span class="p">[</span><span class="s1">&#39;Util&#39;</span><span class="p">][</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;Util&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">annual_util</span><span class="o">=</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;Util&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;line_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="c1"># top annual utilized lines</span>
                <span class="n">top_utilization</span> <span class="o">=</span> <span class="n">annual_util</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

                <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">hist</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plotlib</span><span class="o">.</span><span class="n">create_hist_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">annual_util</span><span class="p">,</span><span class="n">color_dict</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">scenario</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">top_utilization</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                        <span class="n">duration_curve</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Util&#39;</span><span class="p">,</span> 
                                                                    <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">duration_curve</span><span class="p">,</span> <span class="s1">&#39;Util&#39;</span> <span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">))</span>
                        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
                              <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annual_util</span><span class="p">)</span>

            <span class="c1">#Remove extra axes</span>
            <span class="k">if</span> <span class="n">excess_axs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">excess_axs</span><span class="p">,</span><span class="n">grid_size</span><span class="p">)</span>

            <span class="c1"># add facet labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>

            <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                            <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hist</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="s1">&#39;All Lines&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="n">prop</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of lines&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                           <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Line Utilization: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                           <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
                    <span class="n">prop_name</span> <span class="o">=</span><span class="s1">&#39;Top 10 Lines&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prop_name</span> <span class="o">=</span> <span class="n">prop</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Line Utilization: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                           <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                           <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">annual_util</span><span class="p">,</span> 
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">Data_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig2</span><span class="p">,</span><span class="s1">&#39;data_table&#39;</span><span class="p">:</span><span class="n">Data_Out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="MPlot.int_flow_ind"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.int_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">int_flow_ind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a line plot of interchange flows and their import and export limits.</span>

<span class="sd">        Each interchange is potted on a separate facet plot.</span>
<span class="sd">        The plot includes every interchange that originates or ends in the aggregation zone.</span>
<span class="sd">        This can be adjusted by passing a comma separated string of interchanges to the property input.</span>

<span class="sd">        The code will create either a timeseries or duration curve depending on </span>
<span class="sd">        if the word &#39;duration_curve&#39; is in the figure_name.</span>
<span class="sd">        To make a duration curve, ensure the word &#39;duration_curve&#39; is found in the figure_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): User defined figure output name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            prop (str, optional): Comma separated string of interchanges. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">                </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For all interfaces touching Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># gets correct metadata based on area aggregation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="o">==</span><span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span> <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">line</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_ints</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

            <span class="c1">#flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
            <span class="c1">#flow = flow.droplevel(&#39;interface_category&#39;)</span>

            <span class="n">export_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interface_category&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">import_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>
            <span class="n">reported_ints</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interface_category&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="c1">#Extract time index</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only interfaces specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">reported_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting full time series results.&#39;</span><span class="p">)</span>
            <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">))</span>
            <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">missing_ints</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1">#Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">reported_ints</span><span class="p">:</span>
                    <span class="n">chunks_interf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c1">#TODO: Use auto unit converter </span>
                    <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

                    <span class="c1">#Check if all hours have the same limit.</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                    <span class="n">identical</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                    <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="s1">&#39;import limit&#39;</span><span class="p">]</span>

                    <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

                    <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">([</span><span class="s1">&#39;interface_category&#39;</span><span class="p">,</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
                        <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_int</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>
                            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">single_int</span><span class="p">,</span><span class="n">interf</span><span class="p">)</span>

                        <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">single_int</span><span class="p">,</span> <span class="n">interf</span><span class="p">,</span> 
                                                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="se">\n</span><span class="s2"> interface flow&quot;</span><span class="p">,</span>
                                                <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

                        <span class="c1"># Only print limits if it doesn&#39;t change monthly or if you are plotting a time series. </span>
                        <span class="c1"># Otherwise the limit lines could be misleading.</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span> <span class="ow">or</span> <span class="n">identical</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="c1">#Only plot limits for last scenario.</span>
                                <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;export limit&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;import limit&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
                                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="s1">&#39;export limit&#39;</span><span class="p">,</span>
                                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">,</span>
                                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="s1">&#39;import limit&#39;</span><span class="p">,</span> 
                                                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;import limit&#39;</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">,</span>
                                                         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

                        <span class="c1">#For output time series .csv</span>
                        <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_int</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                        <span class="n">single_int_out</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">chunks_interf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_int_out</span><span class="p">)</span>

                    <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_interf</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">Data_out_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interf</span><span class="si">}</span><span class="s2"> not found in results. Have you tagged &quot;</span>
                                        <span class="s2">&quot;it with the &#39;Must Report&#39; property in PLEXOS?&quot;</span><span class="p">)</span>
                    <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">missing_ints</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">missing_ints</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">):</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">index_name</span> <span class="o">=</span> <span class="s1">&#39;level_0&#39;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s1">&#39;timestamp&#39;</span>
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_name</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
            <span class="c1">#Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
            <span class="c1">#Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

            <span class="c1"># Data_Table_Out = Data_Table_Out.reset_index()</span>
            <span class="c1"># Data_Table_Out = Data_Table_Out.groupby(Data_Table_Out.index // 24).mean()</span>
            <span class="c1"># Data_Table_Out.index = pd.date_range(start = &#39;1/1/2024&#39;,end = &#39;12/31/2024&#39;,freq = &#39;D&#39;)</span>

            <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                            <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (GW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> 
                       <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sorted hour of the year&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig2</span><span class="p">,</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>
            <span class="c1">#Limits_Out.to_csv(os.path.join(self.Marmot_Solutions_folder, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>
        <span class="k">return</span> <span class="n">outputs</span> </div>

<div class="viewcode-block" id="MPlot.int_flow_ind_seasonal"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.int_flow_ind_seasonal">[docs]</a>    <span class="k">def</span> <span class="nf">int_flow_ind_seasonal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                              <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                              <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;#TODO: Finish Docstring </span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): User defined figure output name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            prop (str, optional): Comma separated string of interchanges. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Use auto unit converter in method</span>
        
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For all interfaces touching Zone = &quot;</span><span class="o">+</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># gets correct metadata based on area aggregation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="o">==</span><span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span> <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">line</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_ints</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

            <span class="c1">#flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
            <span class="c1">#flow = flow.droplevel(&#39;interface_category&#39;)</span>

            <span class="n">export_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;interface_category&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">import_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>
            <span class="n">reported_ints</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;interface_category&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="c1">#Extract time index</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">prop</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only interfaces specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">reported_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Carving out season from &#39;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="n">end_date_range</span><span class="p">)</span>

            <span class="c1">#Remove missing interfaces from the list.</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="c1">#Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">interf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reported_ints</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">interf</span> <span class="o">+</span> <span class="s1">&#39; not found in results.&#39;</span><span class="p">)</span>
                    <span class="n">interf_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">xdim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">ydim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">6</span><span class="o">*</span><span class="n">xdim</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">ydim</span><span class="p">)),</span> 
                                     <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">missing_ints</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1">#Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">chunks_interf</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>
                <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

                <span class="c1">#Check if all hours have the same limit.</span>
                <span class="n">check</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="n">identical</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="s1">&#39;import limit&#39;</span><span class="p">]</span>
                <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

                <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                    <span class="n">single_int</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;interface_name&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                    <span class="n">single_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;interface_category&#39;</span><span class="p">)</span>
                    <span class="n">single_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_int</span><span class="p">)</span>
                    <span class="n">summer</span> <span class="o">=</span> <span class="n">single_int</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                    <span class="n">winter</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                    <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                        <span class="n">summer</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">summer</span><span class="p">,</span><span class="n">interf</span><span class="p">)</span>
                        <span class="n">winter</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">winter</span><span class="p">,</span><span class="n">interf</span><span class="p">)</span>
                        <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">,</span><span class="s1">&#39;export limit&#39;</span><span class="p">)</span>
                        <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">,</span><span class="s1">&#39;export limit&#39;</span><span class="p">)</span>

                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summer</span><span class="p">[</span><span class="n">interf</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> interface flow&#39;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">winter</span><span class="p">[</span><span class="n">interf</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> interface flow&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">summer_lim</span><span class="p">:</span>
                            <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;export limit&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;import limit&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                          <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                                          <span class="n">color</span><span class="o">=</span><span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

                    <span class="c1">#For output time series .csv</span>
                    <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_int</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                    <span class="n">single_int_out</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">chunks_interf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_int_out</span><span class="p">)</span>

                <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_interf</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Data_out_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>


                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
                    <span class="n">formatter</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">ConciseDateFormatter</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="se">\n</span><span class="s1"> %b&#39;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;%b</span><span class="se">\n</span><span class="s1"> %Y&#39;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="se">\n</span><span class="s1"> %b&#39;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">zero_formats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;%H:%M</span><span class="se">\n</span><span class="s1"> </span><span class="si">%d</span><span class="s1">-%b&#39;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">offset_formats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;%b %Y&#39;</span>
                    <span class="n">formatter</span><span class="o">.</span><span class="n">show_offset</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>


            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">#Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
            <span class="c1">#Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

            <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (GW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sorted hour of the year&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

            <span class="n">fig2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.98</span><span class="p">,</span><span class="s1">&#39;Summer (&#39;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="n">end_date_range</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">fig2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.58</span><span class="p">,</span><span class="mf">0.98</span><span class="p">,</span><span class="s1">&#39;Winter&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>            
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig2</span><span class="p">,</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>
            <span class="c1">#Limits_Out.to_csv(os.path.join(self.Marmot_Solutions_folder, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="c1">#TODO: re-organize parameters (self vs. not self)</span>
<div class="viewcode-block" id="MPlot.int_flow_ind_diff"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.int_flow_ind_diff">[docs]</a>    <span class="k">def</span> <span class="nf">int_flow_ind_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot under development</span>

<span class="sd">        This method plots the hourly difference in interface flow between two scenarios for </span>
<span class="sd">        individual interfaces, with a facet for each interface.</span>
<span class="sd">        The two scenarios are defined in the &quot;Scenario_Diff&quot; row of Marmot_user_defined_inputs.</span>
<span class="sd">        The interfaces are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        The figure and data tables are saved within the module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            UnderDevelopment(): Exception class, plot is not functional. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UnderDevelopment</span><span class="p">()</span> <span class="c1"># TODO: add new get_data method </span>
        
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Flow_Collection</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Import_Limit_Collection</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Export_Limit_Collection</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">get_data</span><span class="p">(</span><span class="n">Flow_Collection</span><span class="p">,</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)])</span>
        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">get_data</span><span class="p">(</span><span class="n">Import_Limit_Collection</span><span class="p">,</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)])</span>
        <span class="n">check_input_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">get_data</span><span class="p">(</span><span class="n">Export_Limit_Collection</span><span class="p">,</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)])</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)))</span>
        
        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;For all interfaces touching Zone = &quot;</span><span class="o">+</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># gets correct metadata based on area aggregation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="o">==</span><span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Column to Aggregate by is missing&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">zone_lines</span> <span class="o">=</span> <span class="n">zone_lines</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span> <span class="c1">#Map lines to interfaces</span>
            <span class="n">all_ints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">line</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">all_ints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_ints</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">zone_lines</span><span class="p">)]</span>

            <span class="c1">#flow = flow[flow.index.get_level_values(&#39;interface_name&#39;).isin(ints.interface)] #Limit to only interfaces touching to this zone</span>
            <span class="c1">#flow = flow.droplevel(&#39;interface_category&#39;)</span>

            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">Export_Limit_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;interface_category&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">export_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">Import_Limit_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ints</span><span class="o">.</span><span class="n">interface</span><span class="p">)]</span>
            <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced interfaces.</span>
            <span class="n">reported_ints</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="c1">#Drop unnecessary columns.</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;interface_category&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">import_limits</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            
            <span class="c1">#Extract time index</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="n">Flow_Collection</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only interfaces specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interf_list</span> <span class="o">=</span> <span class="n">reported_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting full time series results.&#39;</span><span class="p">)</span>
            <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">))</span>
            <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
            <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">missing_ints</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">interf_list</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1">#Remove leading spaces</span>
                <span class="k">if</span> <span class="n">interf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">interf</span> <span class="o">=</span> <span class="n">interf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">interf</span> <span class="ow">in</span> <span class="n">reported_ints</span><span class="p">:</span>
                    <span class="n">chunks_interf</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>         <span class="c1">#TODO: Use auto unit converter in method</span>
                    <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interf</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

                    <span class="c1">#Check if all hours have the same limit.</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                    <span class="n">identical</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">check</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                    <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="s1">&#39;import limit&#39;</span><span class="p">]</span>

                    <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

                    <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="n">Flow_Collection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;interface_name&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;interface_category&#39;</span><span class="p">)</span>
                        <span class="n">single_int</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_int</span><span class="p">)</span>

                        <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
                        <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">):</span>
        
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">single_int</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">]</span>
                            <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                            <span class="n">single_int</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">single_int</span><span class="p">,</span><span class="n">interf</span><span class="p">)</span>
                            

                        <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">single_int</span><span class="p">,</span><span class="n">interf</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> interface flow&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
                        
                        <span class="c1">#Only print limits if it doesn&#39;t change monthly or if you are plotting a time series. Otherwise the limit lines could be misleading.</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span> <span class="ow">or</span> <span class="n">identical</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> 
                            <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="c1">#Only plot limits for last scenario.</span>
                                <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;export limit&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;import limit&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
                                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">limits</span><span class="p">,</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="n">color_dict</span> <span class="o">=</span> <span class="n">limits_color_dict</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
                                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">limits</span><span class="p">,</span><span class="s1">&#39;import limit&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;import limit&#39;</span><span class="p">,</span><span class="n">color_dict</span> <span class="o">=</span> <span class="n">limits_color_dict</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>

                        <span class="c1">#For output time series .csv</span>
                        <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_int</span><span class="p">),</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                        <span class="n">single_int_out</span> <span class="o">=</span> <span class="n">single_int</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span><span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="n">chunks_interf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_int_out</span><span class="p">)</span>

                    <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_interf</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">Data_out_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">interf</span><span class="p">]</span>
                    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">interf</span> <span class="o">+</span> <span class="s1">&#39; not found in results. Have you tagged it with the &quot;Must Report&quot; property in PLEXOS?&#39;</span><span class="p">)</span>
                    <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">missing_ints</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">interf</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">missing_ints</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">interf_list</span><span class="p">):</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">index_name</span> <span class="o">=</span> <span class="s1">&#39;level_0&#39;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s1">&#39;timestamp&#39;</span>
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_name</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
            <span class="c1">#Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
            <span class="c1">#Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

            <span class="c1"># Data_Table_Out = Data_Table_Out.reset_index()</span>
            <span class="c1"># Data_Table_Out = Data_Table_Out.groupby(Data_Table_Out.index // 24).mean()</span>
            <span class="c1"># Data_Table_Out.index = pd.date_range(start = &#39;1/1/2024&#39;,end = &#39;12/31/2024&#39;,freq = &#39;D&#39;)</span>

            <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (GW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sorted hour of the year&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>            
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig2</span><span class="p">,</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>
            <span class="c1">#Limits_Out.to_csv(os.path.join(self.Marmot_Solutions_folder, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interface_Limits.csv&#39;))</span>
        <span class="k">return</span> <span class="n">outputs</span></div>


<div class="viewcode-block" id="MPlot.line_flow_ind"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring </span>


<span class="sd">        This method plots flow, import and export limit, for individual transmission lines, </span>
<span class="sd">        with a facet for each line.</span>
<span class="sd">        The lines are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        The plot includes every interchange that originates or ends in the aggregation zone.</span>
<span class="sd">        Figures and data tables are returned to plot_main</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): [description]. Defaults to None.</span>
<span class="sd">            prop (str, optional): [description]. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Use auto unit converter in method</span>
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1">#Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_lines</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only lines specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#Select single scenario for purpose of extracting limits.</span>

        <span class="n">export_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
        <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
        <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced lines.</span>

        <span class="n">import_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
        <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
        <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced lines.</span>


        <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>

        <span class="c1"># limited_lines = []</span>
        <span class="c1"># i = 0</span>
        <span class="c1"># all_lines = flows.index.get_level_values(&#39;line_name&#39;).unique()</span>

        <span class="c1"># for line in all_lines:</span>
        <span class="c1">#     i += 1</span>
        <span class="c1">#     print(line)</span>
        <span class="c1">#     print(i / len(all_lines))</span>
        <span class="c1">#     exp = export_limits.loc[line].squeeze()[0]</span>
        <span class="c1">#     imp = import_limits.loc[line].squeeze()[0]</span>
        <span class="c1">#     flow = flows.xs(line,level = &#39;line_name&#39;)[0].tolist()</span>
        <span class="c1">#     if exp in flow or imp in flow:</span>
        <span class="c1">#         limited_lines.append(line)</span>

        <span class="c1"># print(limited_lines)</span>
        <span class="c1"># pd.DataFrame(limited_lines).to_csv(&#39;/Users/mschwarz/OR OSW local/Solutions/Figures_Output/limited_lines.csv&#39;)</span>

        <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">))</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1">#plt.subplots_adjust(wspace=0.05, hspace=0.2)</span>

        <span class="n">reported_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">missing_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reported_lines</span><span class="p">:</span>
                <span class="n">chunks_line</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">])</span>
                <span class="n">limits_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
                <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
                <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">single_imp_lim</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

                <span class="c1"># If export/import limits were pulled as an interval property, take the average.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_exp_lim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">single_imp_lim</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">],</span><span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">limits_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;line_name&#39;</span><span class="p">)</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
                    <span class="n">single_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">single_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                    <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                        <span class="n">single_line</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">single_line</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

                    <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">single_line</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> line flow&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>

                    <span class="c1">#Add %congested number to plot.</span>
                    <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>

                        <span class="n">viol_exp</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">single_line</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">single_exp_lim</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                        <span class="n">viol_imp</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">single_line</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">single_imp_lim</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                        <span class="n">viol_perc</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">viol_exp</span> <span class="o">+</span> <span class="n">viol_imp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>
                        <span class="n">viol_perc</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">viol_perc</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Violation = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">viol_perc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f hours&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.15</span><span class="p">),</span><span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

                        <span class="n">cong_exp</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">single_line</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">==</span> <span class="n">single_exp_lim</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                        <span class="n">cong_imp</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">single_line</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">==</span> <span class="n">single_imp_lim</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
                        <span class="n">cong_perc</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">cong_exp</span> <span class="o">+</span> <span class="n">cong_imp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>
                        <span class="n">cong_perc</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cong_perc</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Congestion = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cong_perc</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f hours&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

                    <span class="c1">#For output time series .csv</span>
                    <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">),</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                    <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line_out</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span><span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">chunks_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

                <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_line</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; not found in results. Have you tagged it with the &quot;Must Report&quot; property in PLEXOS?&#39;</span><span class="p">)</span>
                <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">missing_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">excess_axs</span><span class="p">,</span><span class="n">grid_size</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">single_exp_lim</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Export Limit&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">single_imp_lim</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Import Limit&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">missing_lines</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
        <span class="c1">#Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

        <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (MW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1">#plt.tight_layout(rect=[0, 0.03, 1, 0.97])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s1">&#39;_duration_curve&#39;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

        <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">))</span>
       <span class="c1"># Limits_Out.to_csv(os.path.join(self.Marmot_Solutions_folder, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,figure_name + &#39;limits.csv&#39;))</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.line_flow_ind_diff"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_flow_ind_diff">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring </span>

<span class="sd">        This method plots the flow difference for individual transmission lines, with a facet for each line.</span>
<span class="sd">        The scenarios are specified in the &quot;Scenario_Diff_plot&quot; field of Marmot_user_defined_inputs.csv.</span>
<span class="sd">        The lines are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        Figures and data tables are saved in the module.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): [description]. Defaults to None.</span>
<span class="sd">            prop (str, optional): [description]. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Use auto unit converter in method</span>
        
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="c1">#Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_lines</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">InputSheetError</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only lines specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span> 
        <span class="n">flow_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenario_Diff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenario_Diff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">))</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdim</span><span class="p">,</span><span class="n">ydim</span><span class="p">,</span><span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">reported_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">missing_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reported_lines</span><span class="p">:</span>


                <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow_diff</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;line_name&#39;</span><span class="p">)</span>
                <span class="n">single_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">single_line</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                                        
                <span class="c1">#plotlib.create_line_plot(axs,single_line,line, label = self.Scenario_Diff[1] + &#39; - \n&#39; + self.Scenario_Diff[0] + &#39;\n line flow&#39;, n = n)</span>
                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">single_line</span><span class="p">,</span><span class="n">line</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;BESS - no BESS </span><span class="se">\n</span><span class="s1"> line flow&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; not found in results. Have you tagged it with the &quot;Must Report&quot; property in PLEXOS?&#39;</span><span class="p">)</span>
                <span class="n">excess_axs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">missing_lines</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">excess_axs</span><span class="p">,</span><span class="n">grid_size</span><span class="p">)</span>     
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>

            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_lines</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>


        <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow difference (MW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s1">&#39;_duration_curve&#39;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

        <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="n">figure_name</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">))</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.line_flow_ind_seasonal"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_flow_ind_seasonal">[docs]</a>    <span class="k">def</span> <span class="nf">line_flow_ind_seasonal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;#TODO: Finish Docstring </span>

<span class="sd">        This method differs from the previous method, in that it plots seasonal line limits.</span>
<span class="sd">        To use this method, line import/export must be an &quot;interval&quot; property, not a &quot;year&quot; property.</span>
<span class="sd">        This can be selected in  &quot;plexos_properties.csv&quot;.</span>
<span class="sd">        Re-run the formatter if necessary, it will overwrite the existing properties in &quot;*_formatted.h5&quot;</span>

<span class="sd">        This method plots flow, import and export limit, for individual transmission lines, with a facet for each line.</span>
<span class="sd">        The lines are specified in the plot properties field of Marmot_plot_select.csv (column 4).</span>
<span class="sd">        The plot includes every interchange that originates or ends in the aggregation zone. </span>
<span class="sd">        Figures and data tables saved in the module.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): [description]. Defaults to None.</span>
<span class="sd">            prop (str, optional): [description]. Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): [description]. Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): [description]. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: Use auto unit converter in method</span>

        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;You are attempting to plot a time series facetted by two seasons,</span><span class="se">\n\</span>
<span class="s1">            but you are missing a value in the &quot;Start Date&quot; column of &quot;Marmot_plot_select.csv&quot; </span><span class="se">\</span>
<span class="s1">            Please enter dates in &quot;Start Date&quot; and &quot;End Date&quot;. These will define the bounds of </span><span class="se">\</span>
<span class="s1">            one of your two seasons. The other season will be comprised of the rest of the year.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>
        
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1">#Select only lines specified in Marmot_plot_select.csv.</span>
        <span class="n">select_lines</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_lines</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only lines specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#Line limits are seasonal.</span>
        <span class="n">export_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
        <span class="n">export_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
        <span class="n">export_limits</span> <span class="o">=</span> <span class="n">export_limits</span><span class="p">[</span><span class="n">export_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced lines.</span>

        <span class="n">import_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
        <span class="n">import_limits</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#if limit is zero set to small value</span>
        <span class="n">import_limits</span> <span class="o">=</span> <span class="n">import_limits</span><span class="p">[</span><span class="n">import_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">99998</span><span class="p">]</span> <span class="c1">#Filter out unenforced lines.</span>

        <span class="c1">#Extract time index</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">reported_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Carving out season from &#39;</span> <span class="o">+</span> <span class="n">start_date_range</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="n">end_date_range</span><span class="p">)</span>

        <span class="c1">#Remove missing interfaces from the list.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="c1">#Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reported_lines</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; not found in results.&#39;</span><span class="p">)</span>
                <span class="n">select_lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">xdim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ydim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdim</span> <span class="o">*</span> <span class="n">ydim</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ydim</span><span class="p">,</span><span class="n">xdim</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">6</span><span class="o">*</span><span class="n">xdim</span><span class="p">),(</span><span class="mi">4</span><span class="o">*</span><span class="n">ydim</span><span class="p">)),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#Not using plotlib.setup_plot here, I used two dimensional axis array so don&#39;t want to axs.ravel().</span>

        <span class="c1">#plt.subplots_adjust(wspace=0.05, hspace=0.2)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">missing_lines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">limits_chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">select_lines</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#Remove leading spaces</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">chunks_line</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">single_exp_lim</span> <span class="o">=</span> <span class="n">export_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="n">single_exp_lim</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>
            <span class="n">single_imp_lim</span> <span class="o">=</span> <span class="n">import_limits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="n">single_imp_lim</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>

            <span class="n">limits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">single_exp_lim</span><span class="p">,</span><span class="n">single_imp_lim</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;export limit&#39;</span><span class="p">,</span><span class="s1">&#39;import limit&#39;</span><span class="p">]</span>
            <span class="n">limits</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ti</span>
            <span class="n">limits_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
                <span class="n">single_line</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">level</span> <span class="o">=</span> <span class="s1">&#39;line_name&#39;</span><span class="p">)</span>
                <span class="n">single_line</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">single_line</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">single_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">single_line</span><span class="p">)</span>

                <span class="c1">#Split into seasons.</span>
                <span class="n">summer</span> <span class="o">=</span> <span class="n">single_line</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>
                <span class="n">winter</span> <span class="o">=</span> <span class="n">single_line</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="n">start_date_range</span><span class="p">:</span><span class="n">end_date_range</span><span class="p">]</span>
                <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summer</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">summer</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">summer</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">winter</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">winter</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">summer_lim</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">,</span><span class="s1">&#39;export limit&#39;</span><span class="p">)</span>
                    <span class="n">winter_lim</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">,</span><span class="s1">&#39;export limit&#39;</span><span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summer</span><span class="p">[</span><span class="n">line</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> line flow&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">winter</span><span class="p">[</span><span class="n">line</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> line flow&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">summer_lim</span><span class="p">:</span>
                        <span class="n">limits_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;export limit&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;import limit&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">summer_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">winter_lim</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">limits_color_dict</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1">#For output time series .csv</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">),</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                <span class="n">single_line_out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="n">single_line_out</span> <span class="o">=</span> <span class="n">single_line_out</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span><span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">chunks_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_line_out</span><span class="p">)</span>

            <span class="n">Data_out_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks_line</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Data_out_line</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">missing_lines</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">select_lines</span><span class="p">):</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">MissingInputData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">outputs</span>

        <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Limits_Out = pd.concat(limits_chunks,axis = 1)</span>
        <span class="c1">#Limits_Out.index = [&#39;Export Limit&#39;,&#39;Import Limit&#39;]</span>

        <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Summer (Jun - Sep)&#39;</span><span class="p">)</span>
        <span class="n">fig2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Winter (Jan - Mar,Oct - Dec)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (MW)&#39;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">fn_suffix</span> <span class="o">=</span> <span class="s1">&#39;_duration_curve&#39;</span> <span class="k">if</span> <span class="n">duration_curve</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>


        <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="s1">&#39;Individual_Line_Flow&#39;</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;_seasonal.svg&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="s1">&#39;Individual_Line_Flow&#39;</span> <span class="o">+</span> <span class="n">fn_suffix</span> <span class="o">+</span> <span class="s1">&#39;_seasonal.csv&#39;</span><span class="p">))</span>
        <span class="c1">#Limits_Out.to_csv(os.path.join(self.Marmot_Solutions_folder, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Line_Limits.csv&#39;))</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.extract_tx_cap"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.extract_tx_cap">[docs]</a>    <span class="k">def</span> <span class="nf">extract_tx_cap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot under development</span>

<span class="sd">        Returns:</span>
<span class="sd">            UnderDevelopment(): Exception class, plot is not functional. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UnderDevelopment</span><span class="p">()</span> <span class="c1">#TODO: Needs finishing</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Import_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">),</span>
                      <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Export_Limit&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>

                <span class="c1">#Lines</span>
                <span class="c1"># lines = self.meta.region_interregionallines(scenario)</span>
                <span class="c1"># if scenario == &#39;ADS&#39;:</span>
                <span class="c1">#     zone_input = zone_input.split(&#39;_WI&#39;)[0]</span>
                <span class="c1">#     lines = self.meta_ADS.region_interregionallines()</span>

                <span class="c1"># lines = lines[lines[&#39;region&#39;] == zone_input]</span>
                <span class="c1"># import_lim = self[&quot;line_Import_Limit&quot;][scenario].reset_index()</span>
                <span class="c1"># export_lim = self[&quot;line_Export_Limit&quot;][scenario].reset_index()</span>
                <span class="c1"># lines = lines.merge(import_lim,how = &#39;inner&#39;,on = &#39;line_name&#39;)</span>
                <span class="c1"># lines = lines[[&#39;line_name&#39;,0]]</span>
                <span class="c1"># lines.columns = [&#39;line_name&#39;,&#39;import_limit&#39;]</span>
                <span class="c1"># lines = lines.merge(export_lim, how = &#39;inner&#39;,on = &#39;line_name&#39;)</span>
                <span class="c1"># lines = lines[[&#39;line_name&#39;,&#39;import_limit&#39;,0]]</span>
                <span class="c1"># lines.columns = [&#39;line_name&#39;,&#39;import_limit&#39;,&#39;export_limit&#39;]</span>

                <span class="c1"># fn = os.path.join(self.Marmot_Solutions_folder, &#39;NARIS&#39;, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Interregional_Line_Limits_&#39; + scenario + &#39;.csv&#39;)</span>
                <span class="c1"># lines.to_csv(fn)</span>

                <span class="c1"># lines = self.meta.region_intraregionallines(scenario)</span>
                <span class="c1"># if scenario == &#39;ADS&#39;:</span>
                <span class="c1">#     lines = self.meta_ADS.region_intraregionallines()</span>

                <span class="c1"># lines = lines[lines[&#39;region&#39;] == zone_input]</span>
                <span class="c1"># import_lim = self[&quot;line_Import_Limit&quot;][scenario].reset_index()</span>
                <span class="c1"># export_lim = self[&quot;line_Export_Limit&quot;][scenario].reset_index()</span>
                <span class="c1"># lines = lines.merge(import_lim,how = &#39;inner&#39;,on = &#39;line_name&#39;)</span>
                <span class="c1"># lines = lines[[&#39;line_name&#39;,0]]</span>
                <span class="c1"># lines.columns = [&#39;line_name&#39;,&#39;import_limit&#39;]</span>
                <span class="c1"># lines = lines.merge(export_lim, how = &#39;inner&#39;,on = &#39;line_name&#39;)</span>
                <span class="c1"># lines = lines[[&#39;line_name&#39;,&#39;import_limit&#39;,0]]</span>
                <span class="c1"># lines.columns = [&#39;line_name&#39;,&#39;import_limit&#39;,&#39;export_limit&#39;]</span>

                <span class="c1"># fn = os.path.join(self.Marmot_Solutions_folder, &#39;NARIS&#39;, &#39;Figures_Output&#39;,self.AGG_BY + &#39;_transmission&#39;,&#39;Individual_Intraregional_Line_Limits_&#39; + scenario + &#39;.csv&#39;)</span>
                <span class="c1"># lines.to_csv(fn)</span>


                <span class="c1">#Interfaces</span>
                <span class="n">PSCo_ints</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P39 TOT 5_WI&#39;</span><span class="p">,</span><span class="s1">&#39;P40 TOT 7_WI&#39;</span><span class="p">]</span>

                <span class="n">int_import_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Import_Limit&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">int_export_lim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Export_Limit&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;NARIS&#39;</span><span class="p">:</span>
                    <span class="n">last_timestamp</span> <span class="o">=</span> <span class="n">int_import_lim</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#Last because ADS uses the last timestamp.</span>
                    <span class="n">int_import_lim</span> <span class="o">=</span> <span class="n">int_import_lim</span><span class="p">[</span><span class="n">int_import_lim</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">last_timestamp</span><span class="p">]</span>
                    <span class="n">int_export_lim</span> <span class="o">=</span> <span class="n">int_export_lim</span><span class="p">[</span><span class="n">int_export_lim</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">last_timestamp</span><span class="p">]</span>
                    <span class="n">lines2ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_ADS</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines2ints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">interface_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s1">&#39;NARIS&#39;</span><span class="p">,</span> <span class="s1">&#39;Figures_Output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">,</span><span class="s1">&#39;test_meta_&#39;</span> <span class="o">+</span> <span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
                <span class="n">lines2ints</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>


                <span class="n">ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">int_import_lim</span><span class="p">,</span><span class="n">int_export_lim</span><span class="p">,</span><span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;interface_name&#39;</span><span class="p">)</span>
                <span class="n">ints</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0_x&#39;</span><span class="p">:</span><span class="s1">&#39;import_limit&#39;</span><span class="p">,</span><span class="s1">&#39;0_y&#39;</span><span class="p">:</span> <span class="s1">&#39;export_limit&#39;</span><span class="p">},</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">all_lines_in_ints</span> <span class="o">=</span> <span class="n">lines2ints</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_lines_in_ints</span><span class="p">]</span>
                <span class="n">ints</span> <span class="o">=</span> <span class="n">ints</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lines2ints</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;interface_name&#39;</span><span class="p">,</span><span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;interface&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MPlot.region_region_interchange_all_scenarios"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.region_region_interchange_all_scenarios">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_interchange_all_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring </span>

<span class="sd">        This method creates a timeseries line plot of interchange flows between the selected region</span>
<span class="sd">        to each connecting region.</span>
<span class="sd">        If there are more than 4 total interchanges, all other interchanges are aggregated into an &#39;other&#39; grouping</span>
<span class="sd">        Each scenarios is plotted on a separate Facet plot.</span>
<span class="sd">        Figures and data tables are returned to plot_main</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_region_interchange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.region_region_interchange_all_regions"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.region_region_interchange_all_regions">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_interchange_all_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #TODO: Finish Docstring </span>

<span class="sd">        This method creates a timeseries line plot of interchange flows between the selected region</span>
<span class="sd">        to each connecting region. All regions are plotted on a single figure with each focus region placed on a separate</span>
<span class="sd">        facet plot</span>
<span class="sd">        If there are more than 4 total interchanges, all other interchanges are aggregated into an &#39;other&#39; grouping</span>
<span class="sd">        This figure only plots a single scenario that is defined by Main_scenario_plot in user_defined_inputs.csv.</span>
<span class="sd">        Figures and data tables are saved within method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_region_interchange</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">plot_scenario</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_region_region_interchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plot_scenario</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;#TODO: Finish Docstring </span>

<span class="sd">        Args:</span>
<span class="sd">            scenario_type (str): [description]</span>
<span class="sd">            plot_scenario (bool, optional): [description]. Defaults to True.</span>
<span class="sd">            timezone (str, optional): [description]. Defaults to &quot;&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;zone&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">,</span><span class="n">scenario_type</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_facet_xy_dimensions</span><span class="p">(</span><span class="n">multi_scenario</span><span class="o">=</span><span class="n">scenario_type</span><span class="p">)</span>

            <span class="n">fig3</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span><span class="n">ydimension</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="n">data_table_chunks</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenario_type</span><span class="p">:</span>

                <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">rr_int</span><span class="p">)</span>

                <span class="c1"># For plot_main handeling - need to find better solution</span>
                <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">outputs</span><span class="o">=</span><span class="p">{}</span>
                    <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
                        <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s1">&#39;region&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                    <span class="n">agg_region_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Region_Mapping</span><span class="p">[[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span>
                    <span class="c1"># Checks if keys all aggregate to a single value, this plot requires multiple values to work </span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>

                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span><span class="s1">&#39;child&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="c1"># If plotting all regions update plot setup</span>
                <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1">#Make a facet plot, one panel for each parent zone.</span>
                    <span class="n">parent_region</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_region</span><span class="p">)</span>
                    <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="n">plot_number</span><span class="p">)</span>
                    <span class="n">fig3</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span><span class="n">ydimension</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parent_region</span> <span class="o">=</span> <span class="p">[</span><span class="n">zone_input</span><span class="p">]</span>
                    <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario_type</span><span class="p">)</span>

                <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdimension</span><span class="o">*</span><span class="n">ydimension</span>
                <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parent_region</span><span class="p">:</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="p">[</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parent</span><span class="p">]</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;child&#39;</span><span class="p">,</span><span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;flow (MW)&#39;</span><span class="p">)</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="n">single_parent</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)]</span> <span class="c1">#Remove all 0 columns (uninteresting).</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="ow">in</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                        <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="p">])</span> <span class="c1">#Remove columns if parent = child</span>

                    <span class="c1">#Neaten up lines: if more than 4 total interchanges, aggregated all but the highest 3.</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="c1"># Set the &quot;three highest zonal interchanges&quot; for all three scenarios.</span>
                        <span class="n">cols_dontagg</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                        <span class="n">df_dontagg</span> <span class="o">=</span> <span class="n">single_parent</span><span class="p">[</span><span class="n">cols_dontagg</span><span class="p">]</span>
                        <span class="n">df_toagg</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols_dontagg</span><span class="p">)</span>
                        <span class="n">agged</span> <span class="o">=</span> <span class="n">df_toagg</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">df_dontagg</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_dontagg</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">&#39;Other&#39;</span><span class="p">,</span><span class="n">agged</span><span class="p">)</span>
                        <span class="n">single_parent</span> <span class="o">=</span> <span class="n">df_dontagg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                    <span class="c1">#Convert units</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">single_parent</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    <span class="n">single_parent</span> <span class="o">=</span> <span class="n">single_parent</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;divisor&#39;</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

                        <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">single_parent</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s1">f&#39;</span><span class="p">)))</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                        <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="c1">#Add horizontal line at 0.</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
                <span class="c1"># Create data table for each scenario</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">single_parent</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">single_parent</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="c1"># if plotting all scenarios add facet labels</span>
            <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">fig3</span><span class="p">)</span>

            <span class="c1">#Remove extra axes</span>
            <span class="k">if</span> <span class="n">excess_axs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">excess_axs</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span>

            <span class="n">fig3</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">labelpad</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Net Interchange (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span> <span class="o">=</span> <span class="mi">40</span><span class="p">)</span>

            <span class="c1"># If plotting all regions save output and return none plot_main</span>
            <span class="k">if</span> <span class="n">plot_scenario</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># Location to save to</span>
                <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">rr_int_agg</span>
                <span class="n">save_figures</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">+</span> <span class="s1">&#39;_transmission&#39;</span><span class="p">)</span>
                <span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_figures</span><span class="p">,</span> <span class="s2">&quot;Region_Region_Interchange_</span><span class="si">{}</span><span class="s2">.svg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_figures</span><span class="p">,</span> <span class="s2">&quot;Region_Region_Interchange_</span><span class="si">{}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">outputs</span>

            <span class="n">Data_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_table_chunks</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># if plotting all scenarios return figures to plot_main</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig3</span><span class="p">,</span><span class="s1">&#39;data_table&#39;</span><span class="p">:</span><span class="n">Data_Out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="MPlot.region_region_checkerboard"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.region_region_checkerboard">[docs]</a>    <span class="k">def</span> <span class="nf">region_region_checkerboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a checkerboard/heatmap figure showing total interchanges between regions/zones.</span>

<span class="sd">        Each scenario is plotted on its own facet plot.</span>
<span class="sd">        Plots and Data are saved within the module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;zone&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_x_y_dimension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">))</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdimension</span><span class="o">*</span><span class="n">ydimension</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>

        <span class="n">fig4</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span><span class="p">,</span><span class="n">ydimension</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">max_flow_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Data_Out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
            <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">s_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">rr_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">rr_int</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s1">&#39;region&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">!=</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                    <span class="n">agg_region_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Region_Mapping</span><span class="p">[[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">]</span>
                    <span class="c1"># Checks if keys all aggregate to a single value, this plot requires multiple values to work </span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
                    <span class="n">rr_int</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
                    <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">rr_int</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">agg_region_mapping</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span><span class="s1">&#39;child&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">rr_int_agg</span><span class="o">=</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.01</span><span class="p">]</span> <span class="c1"># Keep only positive flows</span>
            <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">/</span><span class="mi">1000</span> <span class="c1"># MWh -&gt; GWh</span>

            <span class="n">data_out</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data_out</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> flow (GWh)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scenario</span><span class="p">)},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">max_flow</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="p">[</span><span class="s1">&#39;flow (MW)&#39;</span><span class="p">])</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span>
            <span class="n">rr_int_agg</span> <span class="o">=</span> <span class="n">rr_int_agg</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">current_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">()</span>
            <span class="n">current_cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">),</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

            <span class="c1"># Rotate the tick labels and set their alignment.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                 <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>

            <span class="c1">#Delineate the boxes and make room at top and bottom</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rr_int_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">max_flow_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_flow</span><span class="p">)</span>
            <span class="n">Data_Out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_out</span><span class="p">)</span>
            <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>

        <span class="c1">#Remove extra axes</span>
            <span class="k">if</span> <span class="n">excess_axs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">excess_axs</span><span class="p">,</span><span class="n">grid_size</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">max_flow_group</span><span class="p">))</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
        <span class="n">fig4</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span>
        <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Net Interchange [GWh]&#39;</span><span class="p">)</span>
        <span class="n">fig4</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;To Region&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                   <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;From Region&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> 
                   <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

        <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">Data_Out</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">save_figures</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">)</span>
        <span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_figures</span><span class="p">,</span> <span class="s2">&quot;region_region_checkerboard.svg&quot;</span><span class="p">),</span> 
                     <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_figures</span><span class="p">,</span> <span class="s2">&quot;region_region_checkerboard.csv&quot;</span><span class="p">))</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.line_violations_timeseries"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_violations_timeseries">[docs]</a>    <span class="k">def</span> <span class="nf">line_violations_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a timeseries line plot of lineflow violations for each region.</span>

<span class="sd">        The magnitude of each violation is plotted on the y-axis</span>
<span class="sd">        Each sceanrio is plotted as a separate line.</span>

<span class="sd">        This methods calls _violations() to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_violations</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.line_violations_totals"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.line_violations_totals">[docs]</a>    <span class="k">def</span> <span class="nf">line_violations_totals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a barplot of total lineflow violations for each region.</span>

<span class="sd">        Each sceanrio is plotted as a separate bar.</span>

<span class="sd">        This methods calls _violations() and passes the total_violations=True argument </span>
<span class="sd">        to create the figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary containing the created plot and its data table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_violations</span><span class="p">(</span><span class="n">total_violations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

    <span class="k">def</span> <span class="nf">_violations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_violations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                    <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
                    <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates line violation plots, line plot and barplots</span>

<span class="sd">        This methods is called from line_violations_timeseries() and line_violations_totals()</span>

<span class="sd">        Args:</span>
<span class="sd">            total_violations (bool, optional): If True finds the sum of violations. </span>
<span class="sd">                Used to create barplots. Defaults to False.</span>
<span class="sd">            timezone (str, optional): The timezone to display on the x-axes.</span>
<span class="sd">                Defaults to &quot;&quot;.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Violation&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Zone = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="n">line_v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Violation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="n">line_v</span> <span class="o">=</span> <span class="n">line_v</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="n">viol</span> <span class="o">=</span> <span class="n">line_v</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;line_name&#39;</span><span class="p">,</span><span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
                    <span class="n">viol</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;zone&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">viol</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="n">one_zone</span> <span class="o">=</span> <span class="n">viol</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                <span class="n">one_zone</span> <span class="o">=</span> <span class="n">one_zone</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="n">scenario</span><span class="p">})</span>
                <span class="n">one_zone</span> <span class="o">=</span> <span class="n">one_zone</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="c1">#We don&#39;t care the direction of the violation</span>
                <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">all_scenarios</span><span class="p">,</span><span class="n">one_zone</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">all_scenarios</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="c1">#remove columns that are all equal to 0</span>
            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">all_scenarios</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
            
            <span class="k">if</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                <span class="k">continue</span>
            
            <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">all_scenarios</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">all_scenarios</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">/</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;divisor&#39;</span><span class="p">]</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="c1">#Make scenario/color dictionary.</span>
            <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

            <span class="n">fig5</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">()</span>
            <span class="c1">#flatten object</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">total_violations</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="n">all_scenarios_tot</span> <span class="o">=</span> <span class="n">all_scenarios</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">all_scenarios_tot</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">color_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;#333333&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_scenarios_tot</span><span class="o">.</span><span class="n">index</span><span class="p">],</span>
                                                       <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">all_scenarios</span><span class="p">:</span>
                    <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">all_scenarios</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">color_dict</span><span class="o">=</span><span class="n">color_dict</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s1">f&#39;</span><span class="p">)))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">minticks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">maxticks</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">fig5</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Line violations (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig5</span><span class="p">,</span><span class="s1">&#39;data_table&#39;</span><span class="p">:</span><span class="n">Data_Table_Out</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span>

<div class="viewcode-block" id="MPlot.net_export"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.net_export">[docs]</a>    <span class="k">def</span> <span class="nf">net_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
                   <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;creates a timeseries net export line graph.</span>

<span class="sd">        Scenarios are plotted as separate lines.</span>

<span class="sd">        Args:</span>
<span class="sd">            timezone (str, optional): The timezone to display on the x-axes.</span>
<span class="sd">                Defaults to &quot;&quot;.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="o">==</span> <span class="s1">&#39;zone&#39;</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;zone&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Net_Interchange&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">net_export_all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">:</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">net_export_read</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2">_Net_Interchange&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">net_export_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">net_export_read</span><span class="p">)</span>                

                <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export_read</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">zone_input</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="p">)</span>
                <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">scenario</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">                    </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>

                <span class="n">net_export_all_scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">net_export_all_scenarios</span><span class="p">,</span><span class="n">net_export</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="n">net_export_all_scenarios</span> <span class="o">=</span> <span class="n">net_export_all_scenarios</span><span class="o">/</span><span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;divisor&quot;</span><span class="p">]</span>
            <span class="c1"># Data table of values to return to main program</span>
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="c1">#Make scenario/color dictionary.</span>
            <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>

            <span class="n">fig1</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="c1"># flatten object</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">MissingZoneData</span><span class="p">()</span>
                <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">net_export_all_scenarios</span><span class="p">:</span>
                <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">net_export_all_scenarios</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">color_dict</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Net exports (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                              <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">timezone</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                                             <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s1">f&#39;</span><span class="p">)))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> 
                          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

            <span class="n">labels</span> <span class="o">=</span> <span class="n">net_export_all_scenarios</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># create custom handles</span>
            <span class="k">for</span> <span class="n">scen</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">scen_legend_patches</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scen</span><span class="p">])</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scen_legend_patches</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">handles</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> 
                      <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>            
                
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig1</span><span class="p">,</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.zonal_interchange"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.zonal_interchange">[docs]</a>    <span class="k">def</span> <span class="nf">zonal_interchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a line plot of the net interchange between each zone, with a facet for each zone.</span>

<span class="sd">        The method will only work if agg_by = &quot;zone&quot;.</span>

<span class="sd">        The code will create either a timeseries or duration curve depending on </span>
<span class="sd">        if the word &#39;duration_curve&#39; is in the figure_name.</span>
<span class="sd">        To make a duration curve, ensure the word &#39;duration_curve&#39; is found in the figure_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            figure_name (str, optional): User defined figure output name.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zone&quot;</span><span class="p">,</span> <span class="s2">&quot;zones&quot;</span><span class="p">,</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span> <span class="s2">&quot;Zones&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This plot only supports aggregation zone&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
        
        <span class="n">duration_curve</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;duration_curve&#39;</span> <span class="ow">in</span> <span class="n">figure_name</span><span class="p">:</span>
            <span class="n">duration_curve</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># sets up x, y dimensions of plot</span>
        <span class="n">xdimension</span><span class="p">,</span> <span class="n">ydimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_facet_xy_dimensions</span><span class="p">(</span><span class="n">multi_scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">xdimension</span><span class="o">*</span><span class="n">ydimension</span>

        <span class="c1"># Used to calculate any excess axis to delete</span>
        <span class="n">plot_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span>
        <span class="n">excess_axs</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">-</span> <span class="n">plot_number</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">fig7</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="n">xdimension</span> <span class="p">,</span><span class="n">ydimension</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">net_exports_all</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">exp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_exporting_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="n">imp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_importing_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exp_lines</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">imp_lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MissingMetaData</span><span class="p">()</span>

                <span class="n">exp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span>
                <span class="n">imp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span>

                <span class="c1">#Find list of lines that connect each region.</span>
                <span class="n">exp_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>
                <span class="n">imp_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>

                <span class="n">other_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zones</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">other_zones</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Are you sure you set agg_by = zone?&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_leapday</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_for_leapday</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">other_zone</span> <span class="ow">in</span> <span class="n">other_zones</span><span class="p">:</span>
                    <span class="n">exp_other_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>
                    <span class="n">imp_other_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>

                    <span class="n">exp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">exp_oz</span><span class="p">,</span> <span class="n">imp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">,</span>
                                        <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">imp_oz</span><span class="p">,</span> <span class="n">exp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">,</span>
                                        <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span>

                    <span class="c1">#Swap columns for importing lines</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">imp_pair</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;region_from&#39;</span><span class="p">,</span> <span class="s1">&#39;line_name&#39;</span><span class="p">,</span> <span class="s1">&#39;region_to&#39;</span><span class="p">])</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exp_pair</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">])]</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">imp_pair</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">])]</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1">#Check for situations where there are only exporting or importing lines for this zonal pair.</span>
                    <span class="k">if</span> <span class="n">imports</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span>
                    <span class="k">elif</span> <span class="n">export</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="o">-</span><span class="n">imports</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span> <span class="o">-</span> <span class="n">imports</span>
                    <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">other_zone</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">other_zone</span> <span class="o">==</span> <span class="p">[</span><span class="n">other_zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">                            </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">sort_duration</span><span class="p">(</span><span class="n">net_export</span><span class="p">,</span><span class="n">other_zone</span><span class="p">)</span>

                    <span class="n">net_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_export</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;columns&#39;</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">net_exports</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="p">[</span><span class="s1">&#39;Net export&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># unitconversion based off peak export hour, only checked once</span>
                <span class="k">if</span> <span class="n">zone_input</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">net_exports</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;divisor&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">net_exports</span><span class="p">:</span>
                    <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span> <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;Net export&#39;</span> <span class="k">else</span> <span class="s1">&#39;solid&#39;</span>
                    <span class="n">plotlib</span><span class="o">.</span><span class="n">create_line_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">net_exports</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
                                             <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                                                 <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;,.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y_axes_decimalpt</span><span class="si">}</span><span class="s1">f&#39;</span><span class="p">)))</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="c1">#Add horizontal line at 0.</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> 
                                  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;inherit&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">duration_curve</span><span class="p">:</span>
                    <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">set_plot_timeseries_format</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

                <span class="c1">#Add scenario column to output table.</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">net_exports</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">net_exports_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_exports</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_facet_labels</span><span class="p">(</span><span class="n">fig7</span><span class="p">)</span>

            <span class="c1">#Remove extra axes</span>
            <span class="k">if</span> <span class="n">excess_axs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">remove_excess_axs</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span><span class="n">excess_axs</span><span class="p">,</span><span class="n">grid_size</span><span class="p">)</span>

            <span class="n">fig7</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                            <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Net export (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                       <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration_curve</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sorted hour of the year&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            
            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports_all</span><span class="p">)</span>
            <span class="c1"># if plotting all scenarios return figures to plot_main</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig7</span><span class="p">,</span><span class="s1">&#39;data_table&#39;</span> <span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.zonal_interchange_total"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.zonal_interchange_total">[docs]</a>    <span class="k">def</span> <span class="nf">zonal_interchange_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a barplot of the net interchange between each zone, separated by positive and negative flows.</span>

<span class="sd">        The method will only work if agg_by = &quot;zone&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary containing the created plot and its data table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;zone&quot;</span><span class="p">,</span> <span class="s2">&quot;zones&quot;</span><span class="p">,</span> <span class="s2">&quot;Zone&quot;</span><span class="p">,</span> <span class="s2">&quot;Zones&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;This plot only supports aggregation zone&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">UnsupportedAggregation</span><span class="p">()</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">zone_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zones</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">zone_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="c1"># flatten object</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">net_exports_all</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Holds each scenario output table</span>
            <span class="n">data_out_chunk</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>

                <span class="n">exp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_exporting_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="n">imp_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zone_importing_lines</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exp_lines</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">imp_lines</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">MissingMetaData</span><span class="p">()</span>

                <span class="n">exp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;line_name&#39;</span><span class="p">]</span>
                <span class="n">imp_lines</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;line_name&#39;</span><span class="p">]</span>

                <span class="c1">#Find list of lines that connect each region.</span>
                <span class="n">exp_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>
                <span class="n">imp_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">zone_input</span><span class="p">]</span>

                <span class="n">other_zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">zones</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">other_zones</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;line_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">other_zone</span> <span class="ow">in</span> <span class="n">other_zones</span><span class="p">:</span>
                    <span class="n">exp_other_oz</span> <span class="o">=</span> <span class="n">exp_lines</span><span class="p">[</span><span class="n">exp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>
                    <span class="n">imp_other_oz</span> <span class="o">=</span> <span class="n">imp_lines</span><span class="p">[</span><span class="n">imp_lines</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">other_zone</span><span class="p">]</span>

                    <span class="n">exp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">exp_oz</span><span class="p">,</span> <span class="n">imp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">,</span> 
                                        <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">imp_oz</span><span class="p">,</span> <span class="n">exp_other_oz</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">,</span> 
                                        <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;line_name&#39;</span><span class="p">)</span>

                    <span class="c1">#Swap columns for importing lines</span>
                    <span class="n">imp_pair</span> <span class="o">=</span> <span class="n">imp_pair</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;region_from&#39;</span><span class="p">,</span> <span class="s1">&#39;line_name&#39;</span><span class="p">,</span> <span class="s1">&#39;region_to&#39;</span><span class="p">])</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exp_pair</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">])]</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">imp_pair</span><span class="p">[</span><span class="s1">&#39;line_name&#39;</span><span class="p">])]</span>

                    <span class="n">export</span> <span class="o">=</span> <span class="n">export</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1">#Check for situations where there are only exporting or importing lines for this zonal pair.</span>
                    <span class="k">if</span> <span class="n">imports</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span>
                    <span class="k">elif</span> <span class="n">export</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="o">-</span><span class="n">imports</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">export</span> <span class="o">-</span> <span class="n">imports</span>
                    <span class="n">net_export</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">other_zone</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">other_zone</span> <span class="o">==</span> <span class="n">other_zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">                            </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">end_date_range</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="n">net_export</span> <span class="o">=</span> <span class="n">net_export</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>

                    <span class="n">net_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_export</span><span class="p">)</span>

                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">net_exports</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">net_exports</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">net_exports</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">net_exports</span><span class="p">[</span><span class="s1">&#39;Net Export&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">positive</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">negative</span> <span class="o">=</span> <span class="n">net_exports</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

                <span class="c1"># unitconversion based off peak export hour, only checked once</span>
                <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">positive</span><span class="p">[</span><span class="s1">&#39;Net Export&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="nb">abs</span><span class="p">(</span><span class="n">negative</span><span class="p">[</span><span class="s1">&#39;Net Export&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span>

                <span class="n">both</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">positive</span><span class="p">,</span><span class="n">negative</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">both</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Total Export&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Import&quot;</span><span class="p">]</span>
                <span class="n">both</span> <span class="o">=</span> <span class="n">both</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;divisor&#39;</span><span class="p">]</span>
                <span class="n">net_exports_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">both</span><span class="p">)</span>

                <span class="c1">#Add scenario column to output table.</span>
                <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">both</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">both</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">data_out_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>

            <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_out_chunk</span><span class="p">)</span>
            
            <span class="c1">#Make scenario/color dictionary.</span>
            <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>
            
            <span class="n">plotlib</span><span class="o">.</span><span class="n">create_clustered_stacked_bar_plot</span><span class="p">(</span><span class="n">net_exports_all</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> 
                                                      <span class="n">color_dict</span><span class="o">=</span><span class="n">color_dict</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> 
                      <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interchange (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">h)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                          <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mconfig</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="s2">&quot;plot_title_as_region&quot;</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">zone_input</span><span class="p">)</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">zone_input</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span><span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">Data_Table_Out</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">outputs</span></div>

<div class="viewcode-block" id="MPlot.total_int_flow_ind"><a class="viewcode-back" href="../../../references/code/marmot.plottingmodules.transmission.html#marmot.plottingmodules.transmission.MPlot.total_int_flow_ind">[docs]</a>    <span class="k">def</span> <span class="nf">total_int_flow_ind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="n">start_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">end_date_range</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a clustered barplot of the total flow for a specific interface, separated by positive and negative flows.</span>

<span class="sd">        Specify the interface(s) of interest by providing a comma separated </span>
<span class="sd">        string to the property entry.</span>
<span class="sd">        Scenarios are clustered together as different colored bars.</span>
<span class="sd">        If multiple interfaces are provided, each will be plotted as a </span>
<span class="sd">        separate group of clustered bar.</span>

<span class="sd">        Args:</span>
<span class="sd">            prop (str, optional): Comma separated string of interfaces to plot. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            start_date_range (str, optional): Defines a start date at which to represent data from. </span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            end_date_range (str, optional): Defines a end date at which to represent data to.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataSavedInModule: DataSavedInModule exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># List of properties needed by the plot, properties are a set of tuples and contain 3 parts:</span>
        <span class="c1"># required True/False, property name and scenarios required, scenarios must be a list.</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">)]</span>
        
        <span class="c1"># Runs get_formatted_data within PlotDataHelper to populate PlotDataHelper dictionary  </span>
        <span class="c1"># with all required properties, returns a 1 if required data is missing</span>
        <span class="n">check_input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_formatted_data</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">check_input_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MissingInputData</span><span class="p">()</span>

        <span class="c1">#Select only interfaces specified in Marmot_plot_select.csv.</span>
        <span class="n">select_ints</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">select_ints</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InputSheetError</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Plotting only the interfaces specified in Marmot_plot_select.csv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">select_ints</span><span class="p">)</span> 

        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plotlib</span><span class="o">.</span><span class="n">setup_plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># flatten object</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">net_flows_all</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds each scenario output table</span>
        <span class="n">data_out_chunk</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scenario = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">flow_all</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;interface_Flow&quot;</span><span class="p">][</span><span class="n">scenario</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total Export&#39;</span><span class="p">)</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total Import&#39;</span><span class="p">)</span>
            
            <span class="n">available_inter</span> <span class="o">=</span> <span class="n">select_ints</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">select_ints</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow_all</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;interface_name&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">inter</span><span class="si">}</span><span class="s1"> Not in Data&#39;</span><span class="p">)</span>
                    <span class="n">available_inter</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
                    <span class="k">continue</span>
                
                <span class="c1">#Remove leading spaces</span>
                <span class="k">if</span> <span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">inter</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow_all</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;interface_name&#39;</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                 
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting specific date range: </span><span class="se">\</span>
<span class="s2">                    </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">start_date_range</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date_range</span><span class="p">)))</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="n">start_date_range</span> <span class="p">:</span> <span class="n">end_date_range</span><span class="p">]</span>
            
                <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">pos_sing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_sing</span><span class="p">)</span>
                <span class="n">neg_sing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">flow</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">neg</span> <span class="o">=</span> <span class="n">neg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neg_sing</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">scenario</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="nb">abs</span><span class="p">(</span><span class="n">neg</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
                <span class="n">unitconversion</span> <span class="o">=</span> <span class="n">PlotDataHelper</span><span class="o">.</span><span class="n">capacity_energy_unitconversion</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span>

            <span class="n">both</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span><span class="n">neg</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">both</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Export&#39;</span><span class="p">,</span><span class="s1">&#39;Total Import&#39;</span><span class="p">]</span>
            <span class="n">both</span> <span class="o">=</span> <span class="n">both</span> <span class="o">/</span> <span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;divisor&#39;</span><span class="p">]</span>
            <span class="n">both</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">available_inter</span>
            <span class="n">net_flows_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">both</span><span class="p">)</span>

            <span class="c1">#Add scenario column to output table.</span>
            <span class="n">scenario_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">scenario</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">both</span><span class="p">),</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
            <span class="n">data_table</span> <span class="o">=</span> <span class="n">both</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">scenario_names</span><span class="p">],</span><span class="n">append</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">data_table</span> <span class="o">=</span> <span class="n">data_table</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">data_out_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span>
        
        <span class="n">Data_Table_Out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_out_chunk</span><span class="p">)</span>
         
        <span class="c1">#Make scenario/color dictionary.</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_list</span><span class="p">))</span>
        
        <span class="n">plotlib</span><span class="o">.</span><span class="n">create_clustered_stacked_bar_plot</span><span class="p">(</span><span class="n">net_flows_all</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Scenarios</span><span class="p">,</span> 
                                                  <span class="n">color_dict</span><span class="o">=</span><span class="n">color_dict</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> 
                  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flow (</span><span class="si">{}</span><span class="s1">h)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unitconversion</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                      <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s2">&quot;Figures_Output&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Individual_Interface_Total_Flow.svg&quot;</span><span class="p">),</span> 
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">Data_Table_Out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Marmot_Solutions_folder</span><span class="p">,</span> <span class="s2">&quot;Figures_Output&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AGG_BY</span> <span class="si">}</span><span class="s2">_transmission&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;Individual_Interface_Total_Flow.csv&quot;</span><span class="p">))</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">DataSavedInModule</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div></div>
                
    <span class="c1">### Archived Code ####</span>

    <span class="c1"># def line_util_agged(self):</span>

    <span class="c1">#     self[&quot;line_Flow&quot;] = {}</span>
    <span class="c1">#     interface_flow_collection = {}</span>
    <span class="c1">#     line_limit_collection = {}</span>
    <span class="c1">#     interface_limit_collection = {}</span>

    <span class="c1">#     #Load data</span>
    <span class="c1">#     self._getdata(self[&quot;line_Flow&quot;],&quot;line_Flow&quot;)</span>
    <span class="c1">#     self._getdata(interface_flow_collection,&quot;interface_Flow&quot;)</span>
    <span class="c1">#     self._getdata(line_limit_collection,&quot;line_Export_Limit&quot;)</span>
    <span class="c1">#     self._getdata(interface_limit_collection,&quot;interface_Export_Limit&quot;)</span>

    <span class="c1">#     outputs = {}</span>

    <span class="c1">#     for zone_input in self.Zones:</span>
    <span class="c1">#         self.logger.info(&#39;Zone = &#39; + str(zone_input))</span>

    <span class="c1">#         all_scenarios = pd.DataFrame()</span>

    <span class="c1">#         for scenario in self.Scenarios:</span>
    <span class="c1">#             self.logger.info(&quot;Scenario = &quot; + str(scenario))</span>

    <span class="c1">#             lineflow = self[&quot;line_Flow&quot;].get(scenario)</span>
    <span class="c1">#             linelim = line_limit_collection.get(scenario)</span>
    <span class="c1">#             linelim = linelim.reset_index().drop(&#39;timestamp&#39;, axis = 1).set_index(&#39;line_name&#39;)</span>

    <span class="c1">#             #Calculate utilization.</span>
    <span class="c1">#             alllines = pd.merge(lineflow,linelim,left_index=True,right_index=True)</span>
    <span class="c1">#             alllines = alllines.rename(columns = {&#39;0_x&#39;:&#39;flow&#39;,&#39;0_y&#39;:&#39;capacity&#39;})</span>
    <span class="c1">#             alllines[&#39;flow&#39;] = abs(alllines[&#39;flow&#39;])</span>

    <span class="c1">#             #Merge in region ID and aggregate by region.</span>
    <span class="c1">#             if self.AGG_BY == &#39;region&#39;:</span>
    <span class="c1">#                 line2region = self.region_lines</span>
    <span class="c1">#             elif self.AGG_BY == &#39;zone&#39;:</span>
    <span class="c1">#                 line2region = self.zone_lines</span>

    <span class="c1">#             alllines = alllines.reset_index()</span>
    <span class="c1">#             alllines = alllines.merge(line2region, on = &#39;line_name&#39;)</span>

    <span class="c1">#             #Extract ReEDS expansion lines for next section.</span>
    <span class="c1">#             reeds_exp = alllines.merge((self.lines.rename(columns={&quot;name&quot;:&quot;line_name&quot;})), on = &#39;line_name&#39;)</span>
    <span class="c1">#             reeds_exp = reeds_exp[reeds_exp[&#39;category&#39;] == &#39;ReEDS_Expansion&#39;]</span>
    <span class="c1">#             reeds_agg = reeds_exp.groupby([&#39;timestamp&#39;,self.AGG_BY],as_index = False).sum()</span>

    <span class="c1">#             #Subset only enforced lines. This will subset to only EI lines.</span>
    <span class="c1">#             enforced = pd.read_csv(&#39;/projects/continental/pcm/Results/enforced_lines.csv&#39;)</span>
    <span class="c1">#             enforced.columns = [&#39;line_name&#39;]</span>
    <span class="c1">#             lineutil = pd.merge(enforced,alllines, on = &#39;line_name&#39;)</span>

    <span class="c1">#             lineutil[&#39;line util&#39;] = lineutil[&#39;flow&#39;] / lineutil[&#39;capacity&#39;]</span>
    <span class="c1">#             lineutil = lineutil[lineutil.capacity &lt; 10000]</span>

    <span class="c1">#             #Drop duplicates if AGG_BY == Interconnection.</span>

    <span class="c1">#             #Aggregate by region, merge in region mapping.</span>
    <span class="c1">#             agg = alllines.groupby([&#39;timestamp&#39;,self.AGG_BY],as_index = False).sum()</span>
    <span class="c1">#             agg[&#39;util&#39;] = agg[&#39;flow&#39;] / agg[&#39;capacity&#39;]</span>
    <span class="c1">#             agg = agg.rename(columns = {&#39;util&#39; : scenario})</span>
    <span class="c1">#             onezone = agg[agg[self.AGG_BY] == zone_input]</span>
    <span class="c1">#             onezone = onezone.set_index(&#39;timestamp&#39;)[scenario]</span>

    <span class="c1">#             #If zone_input is in WI or ERCOT, the dataframe will be empty here. Lines are not enforced here. Instead, use interfaces.</span>
    <span class="c1">#             if onezone.empty:</span>

    <span class="c1">#                 #Start with interface flow.</span>
    <span class="c1">#                 intflow = interface_flow_collection.get(scenario)</span>
    <span class="c1">#                 intlim = interface_limit_collection.get(scenario)</span>

    <span class="c1">#                 allint = pd.merge(intflow,intlim,left_index=True,right_index=True)</span>
    <span class="c1">#                 allint = allint.rename(columns = {&#39;0_x&#39;:&#39;flow&#39;,&#39;0_y&#39;:&#39;capacity&#39;})</span>
    <span class="c1">#                 allint = allint.reset_index()</span>

    <span class="c1">#                 #Merge in interface/line/region mapping.</span>
    <span class="c1">#                 line2int = self.interface_lines</span>
    <span class="c1">#                 line2int = line2int.rename(columns = {&#39;line&#39; : &#39;line_name&#39;,&#39;interface&#39; : &#39;interface_name&#39;})</span>
    <span class="c1">#                 allint = allint.merge(line2int, on = &#39;interface_name&#39;, how = &#39;inner&#39;)</span>
    <span class="c1">#                 allint = allint.merge(line2region, on = &#39;line_name&#39;)</span>
    <span class="c1">#                 allint = allint.merge(self.Region_Mapping, on = &#39;region&#39;)</span>
    <span class="c1">#                 allint = allint.drop(columns = &#39;line_name&#39;)</span>
    <span class="c1">#                 allint = allint.drop_duplicates() #Merging in line info duplicated most of the interfaces.</span>

    <span class="c1">#                 agg = allint.groupby([&#39;timestamp&#39;,self.AGG_BY],as_index = False).sum()</span>
    <span class="c1">#                 agg = pd.concat([agg,reeds_agg]) #Add in ReEDS expansion lines, re-aggregate.</span>
    <span class="c1">#                 agg = agg.groupby([&#39;timestamp&#39;,self.AGG_BY],as_index = False).sum()</span>
    <span class="c1">#                 agg[&#39;util&#39;] = agg[&#39;flow&#39;] / agg[&#39;capacity&#39;]</span>
    <span class="c1">#                 agg = agg.rename(columns = {&#39;util&#39; : scenario})</span>
    <span class="c1">#                 onezone = agg[agg[self.AGG_BY] == zone_input]</span>
    <span class="c1">#                 onezone = onezone.set_index(&#39;timestamp&#39;)[scenario]</span>

    <span class="c1">#             if (prop != prop) == False: #Show only subset category of lines.</span>
    <span class="c1">#                 reeds_agg = reeds_agg.groupby(&#39;timestamp&#39;,as_index = False).sum()</span>
    <span class="c1">#                 reeds_agg[&#39;util&#39;] = reeds_agg[&#39;flow&#39;] / reeds_agg[&#39;capacity&#39;]</span>
    <span class="c1">#                 onezone = reeds_agg.rename(columns = {&#39;util&#39; : scenario})</span>
    <span class="c1">#                 onezone = onezone.set_index(&#39;timestamp&#39;)[scenario]</span>

    <span class="c1">#             all_scenarios = pd.concat([all_scenarios,onezone], axis = 1)</span>

    <span class="c1">#         # Data table of values to return to main program</span>
    <span class="c1">#         Data_Table_Out = all_scenarios.copy()</span>

    <span class="c1">#         #Make scenario/color dictionary.</span>
    <span class="c1">#         scenario_color_dict = {}</span>
    <span class="c1">#         for idx,column in enumerate(all_scenarios.columns):</span>
    <span class="c1">#             dictionary = {column : self.color_list[idx]}</span>
    <span class="c1">#             scenario_color_dict.update(dictionary)</span>

    <span class="c1">#         all_scenarios.index = pd.to_datetime(all_scenarios.index)</span>

    <span class="c1">#         fig5, ax = plt.subplots(figsize=(9,6))</span>
    <span class="c1">#         for idx,column in enumerate(all_scenarios.columns):</span>
    <span class="c1">#             ax.plot(all_scenarios.index.values,all_scenarios[column], linewidth=2, color = scenario_color_dict.get(column,&#39;#333333&#39;),label=column)</span>

    <span class="c1">#         ax.set_ylabel(&#39;Transmission utilization (%)&#39;,  color=&#39;black&#39;, rotation=&#39;vertical&#39;)</span>
    <span class="c1">#         ax.set_xlabel(timezone,  color=&#39;black&#39;, rotation=&#39;horizontal&#39;)</span>
    <span class="c1">#         ax.spines[&#39;right&#39;].set_visible(False)</span>
    <span class="c1">#         ax.spines[&#39;top&#39;].set_visible(False)</span>
    <span class="c1">#         ax.tick_params(axis=&#39;y&#39;, which=&#39;major&#39;, length=5, width=1)</span>
    <span class="c1">#         ax.tick_params(axis=&#39;x&#39;, which=&#39;major&#39;, length=5, width=1)</span>
    <span class="c1">#         ax.yaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(&#39;{x:,.0f}&#39;))</span>
    <span class="c1">#         ax.margins(x=0.01)</span>

    <span class="c1">#         locator = mdates.AutoDateLocator(minticks=6, maxticks=12)</span>
    <span class="c1">#         formatter = mdates.ConciseDateFormatter(locator)</span>
    <span class="c1">#         formatter.formats[2] = &#39;%d\n %b&#39;</span>
    <span class="c1">#         formatter.zero_formats[1] = &#39;%b\n %Y&#39;</span>
    <span class="c1">#         formatter.zero_formats[2] = &#39;%d\n %b&#39;</span>
    <span class="c1">#         formatter.zero_formats[3] = &#39;%H:%M\n %d-%b&#39;</span>
    <span class="c1">#         formatter.offset_formats[3] = &#39;%b %Y&#39;</span>
    <span class="c1">#         formatter.show_offset = False</span>
    <span class="c1">#         ax.xaxis.set_major_locator(locator)</span>
    <span class="c1">#         ax.xaxis.set_major_formatter(formatter)</span>
    <span class="c1">#         ax.yaxis.set_major_formatter(mtick.PercentFormatter(1.0))</span>
    <span class="c1">#         ax.hlines(y = 1, xmin = ax.get_xlim()[0], xmax = ax.get_xlim()[1], linestyle = &#39;:&#39;) #Add horizontal line at 100%.</span>

    <span class="c1">#         handles, labels = ax.get_legend_handles_labels()</span>

    <span class="c1">#         #Legend 1</span>
    <span class="c1">#         leg1 = ax.legend(reversed(handles), reversed(labels), loc=&#39;best&#39;,facecolor=&#39;inherit&#39;, frameon=True)</span>

    <span class="c1">#         # Manually add the first legend back</span>
    <span class="c1">#         ax.add_artist(leg1)</span>

    <span class="c1">#         outputs[zone_input] = {&#39;fig&#39;: fig5, &#39;data_table&#39;: Data_Table_Out}</span>
    <span class="c1">#     return outputs</span>


<span class="c1">#     def region_region_duration(self):</span>

<span class="c1">#         rr_int = pd.read_hdf(os.path.join(self.Marmot_Solutions_folder,self.Scenarios[0],&quot;Processed_HDF5_folder&quot;, self.Scenarios[0] + &quot;_formatted.h5&quot;),&quot;region_regions_Net_Interchange&quot;)</span>
<span class="c1">#         agg_region_mapping = self.Region_Mapping[[&#39;region&#39;,self.AGG_BY]].set_index(&#39;region&#39;).to_dict()[self.AGG_BY]</span>

<span class="c1">#         rr_int = rr_int.reset_index()</span>
<span class="c1">#         rr_int[&#39;parent&#39;] = rr_int[&#39;parent&#39;].map(agg_region_mapping)</span>
<span class="c1">#         rr_int[&#39;child&#39;]  = rr_int[&#39;child&#39;].map(agg_region_mapping)</span>

<span class="c1">#         rr_int_agg = rr_int.groupby([&#39;parent&#39;,&#39;child&#39;],as_index=True).sum() # Determine annual net flow between regions.</span>
<span class="c1">#         rr_int_agg.rename(columns = {0:&#39;flow (MW)&#39;}, inplace = True)</span>
<span class="c1">#         rr_int_agg = rr_int_agg.reset_index([&#39;parent&#39;,&#39;child&#39;])</span>
<span class="c1">#         rr_int_agg=rr_int_agg.loc[rr_int_agg[&#39;flow (MW)&#39;]&gt;0.01] # Keep only positive flows</span>
<span class="c1"># #        rr_int_agg.set_index([&#39;parent&#39;,&#39;child&#39;],inplace=True)</span>

<span class="c1">#         rr_int_agg[&#39;path&#39;]=rr_int_agg[&#39;parent&#39;]+&quot;_&quot;+rr_int_agg[&#39;child&#39;]</span>

<span class="c1">#         if (prop!=prop)==False: # This checks for a nan in string. If a number of paths is selected only plot those</span>
<span class="c1">#             pathlist=rr_int_agg.sort_values(ascending=False,by=&#39;flow (MW)&#39;)[&#39;path&#39;][1:int(prop)+1] #list of top paths based on number selected</span>
<span class="c1">#         else:</span>
<span class="c1">#             pathlist=rr_int_agg[&#39;path&#39;] #List of paths</span>


<span class="c1">#         rr_int_hr = rr_int.groupby([&#39;timestamp&#39;,&#39;parent&#39;,&#39;child&#39;],as_index=True).sum() # Hourly flow</span>
<span class="c1">#         rr_int_hr.rename(columns = {0:&#39;flow (MW)&#39;}, inplace = True)</span>
<span class="c1">#         rr_int_hr.reset_index([&#39;timestamp&#39;,&#39;parent&#39;,&#39;child&#39;],inplace=True)</span>
<span class="c1">#         rr_int_hr[&#39;path&#39;]=rr_int_hr[&#39;parent&#39;]+&quot;_&quot;+rr_int_hr[&#39;child&#39;]</span>
<span class="c1">#         rr_int_hr.set_index([&#39;path&#39;],inplace=True)</span>
<span class="c1">#         rr_int_hr[&#39;Abs MW&#39;]=abs(rr_int_hr[&#39;flow (MW)&#39;])</span>
<span class="c1">#         rr_int_hr[&#39;Abs MW&#39;].sum()</span>
<span class="c1">#         rr_int_hr.loc[pathlist][&#39;Abs MW&#39;].sum()*2  # Check that the sum of the absolute value of flows is the same. i.e. only redundant flows were eliminated.</span>
<span class="c1">#         rr_int_hr=rr_int_hr.loc[pathlist].drop([&#39;Abs MW&#39;],axis=1)</span>

<span class="c1">#         ## Plot duration curves</span>
<span class="c1">#         fig3, ax3 = plt.subplots(figsize=(9,6))</span>
<span class="c1">#         for i in pathlist:</span>
<span class="c1">#             duration_curve = rr_int_hr.loc[i].sort_values(ascending=False,by=&#39;flow (MW)&#39;).reset_index()</span>
<span class="c1">#             plt.plot(duration_curve[&#39;flow (MW)&#39;],label=i)</span>
<span class="c1">#             del duration_curve</span>

<span class="c1">#         ax3.set_ylabel(&#39;flow MW&#39;,  color=&#39;black&#39;, rotation=&#39;vertical&#39;)</span>
<span class="c1">#         ax3.set_xlabel(&#39;Intervals&#39;,  color=&#39;black&#39;, rotation=&#39;horizontal&#39;)</span>
<span class="c1">#         ax3.spines[&#39;right&#39;].set_visible(False)</span>
<span class="c1">#         ax3.spines[&#39;top&#39;].set_visible(False)</span>

<span class="c1"># #        if (prop!=prop)==False: # This checks for a nan in string. If no limit selected, do nothing</span>
<span class="c1">#         ax3.legend(loc=&#39;best&#39;)</span>
<span class="c1"># #            plt.lim((0,int(prop)))</span>

<span class="c1">#         Data_Table_Out = rr_int_hr</span>

        <span class="c1"># return {&#39;fig&#39;: fig3, &#39;data_table&#39;: Data_Table_Out}</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Alliance for Sustainable Energy, LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>